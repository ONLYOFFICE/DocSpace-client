"use strict";(()=>{var y="/api/2.0/security/csp",f="frameDocSpace",l={src:"",rootPath:"/rooms/shared/",requestToken:null,width:"100%",height:"100%",name:f,type:"desktop",frameId:"ds-frame",mode:"manager",id:null,locale:null,theme:"System",editorType:"desktop",editorGoBack:!0,selectorType:"all",showSelectorCancel:!1,showSelectorHeader:!1,showHeader:!1,showHeaderBanner:"none",showTitle:!0,showMenu:!1,showFilter:!1,showSignOut:!0,destroyText:"",viewAs:"row",viewTableColumns:"Index,Name,Size,Type,Tags",checkCSP:!0,disableActionButton:!1,showSettings:!1,waiting:!1,noLoader:!1,withSearch:!0,withBreadCrumbs:!0,withSubtitle:!0,filterParam:"ALL",buttonColor:"#5299E0",infoPanelVisible:!0,downloadToEvent:!1,filter:{count:"100",page:"1",sortOrder:"descending",sortBy:"DateAndTime",search:"",withSubfolders:!1},editorCustomization:{},events:{onSelectCallback:null,onCloseCallback:null,onAppReady:null,onAppError:null,onEditorCloseCallback:null,onAuthSuccess:null,onSignOut:null,onDownload:null,onNoAccess:null,onNotFound:null,onContentReady:null,onEditorOpen:null}},g="The current domain is not set in the Content Security Policy (CSP) settings.",p="Message bus is not connected with frame";var c=o=>o?(Object.keys(o).forEach(e=>(o[e]===void 0||o[e]===null)&&delete o[e]),new URLSearchParams(o).toString()):"",b=async o=>{let{origin:e,host:t}=window.location;if(e.includes(o))return;let s=await fetch(`${o}${y}`,{method:"get",headers:new Headers({"ngrok-skip-browser-warning":"69420"})}),r;try{r=await s.json()}catch(a){throw new Error(`CSP validation failed: ${a}`)}let{response:{domains:n}}=r,i=t||new URL(e).host;if(!n.map(a=>{try{let u=new URL(a.toLowerCase());return u.host+(u.pathname!=="/"?u.pathname:"")}catch{return a}}).includes(i.toLowerCase()))throw new Error(g)},w=o=>`<body style=background:#f3f4f4><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300"rel=stylesheet><div style="display:flex;flex-direction:column;gap:80px;align-items:center;justify-content:flex-start;margin-top:60px;padding:0 30px"><div style=flex-shrink:0;width:211px;height:24px;position:relative><img src=${o}/static/images/logo/lightsmall.svg></div><div style=display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:flex-start;flex-shrink:0;position:relative><div style=flex-shrink:0;width:120px;height:100px;position:relative><img src=${o}/static/images/frame-error.svg></div><span style="color:#a3a9ae;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px">${g} Please add it via <a href=${o}/portal-settings/developer-tools/javascript-sdk style="color:#4781d1;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px;text-decoration-line:underline"target=_blank>the Developer Tools section</a>.</span></div></div></body>`,T=o=>`@keyframes rotate { 0%{ transform: rotate(-45deg); } 15%{ transform: rotate(45deg); } 30%{ transform: rotate(135deg); } 45%{ transform: rotate(225deg); } 60%, 100%{ transform: rotate(315deg); } } .${o} { width: 74px; height: 74px; border: 4px solid rgba(51,51,51, 0.1); border-top-color: #333333; border-radius: 50%; transform: rotate(-45deg); position: relative; box-sizing: border-box; animation: 1s linear infinite rotate; } @media (prefers-color-scheme: dark) { .${o} { border-color: rgba(204, 204, 204, 0.1); border-top-color: #CCCCCC; } }`,S=()=>{let o=document.currentScript,e=new URL(decodeURIComponent(o.src)).searchParams,t={...l};return e.forEach((s,r)=>{let n=s==="true"?!0:s==="false"?!1:s;l.filter&&r in l.filter?t.filter[r]=n:t[r]=n}),t.mode=e.get("mode")||"manager",t.src=e.get("src")||new URL(decodeURIComponent(o.src)).origin,t},E=o=>{switch(o.mode){case"manager":{o.id&&(o.filter.folder=o.id);let e=o.requestToken?{key:o.requestToken,...o.filter}:o.filter;e?.withSubfolders||delete e?.withSubfolders;let t=c(e);return`${o.rootPath}${o.requestToken?`?${t}`:`${o.id?o.id+"/":""}filter?${t}`}`}case"room-selector":{let e={acceptLabel:o.acceptButtonLabel,cancel:o.showSelectorCancel,cancelLabel:o.cancelButtonLabel,header:o.showSelectorHeader,locale:o.locale,roomType:o.roomType,search:o.withSearch,theme:o.theme},t=c(e);return`/sdk/room-selector${t?`?${t}`:""}`}case"file-selector":{let e={acceptLabel:o.acceptButtonLabel,breadCrumbs:o.withBreadCrumbs,cancel:o.showSelectorCancel,cancelLabel:o.cancelButtonLabel,filter:o.filterParam,header:o.showSelectorHeader,id:o.id,locale:o.locale,roomType:o.roomType,search:o.withSearch,selectorType:o.selectorType,subtitle:o.withSubtitle,theme:o.theme},t=c(e);return`/sdk/file-selector${t?`?${t}`:""}`}case"public-room":{let e={theme:o.theme,locale:o.locale,folder:o.id,key:o.requestToken},t=c(e);return`/sdk/public-room${t?`?${t}`:""}`}case"system":return"/old-sdk/system";case"editor":{o?.editorCustomization&&((o?.editorCustomization).uiTheme=o.theme),(!o.id||o.id==="undefined"||o.id==="null")&&(o.id=-1),o.events?.onEditorCloseCallback&&typeof o.events.onEditorCloseCallback=="function"&&(o.editorGoBack="event");let e=`/doceditor?fileId=${o.id}&editorType=${o.editorType}`;return o.requestToken?`${e}&share=${o.requestToken}&is_file=true`:e}case"viewer":{o?.editorCustomization&&((o?.editorCustomization).uiTheme=o.theme),(!o.id||o.id==="undefined"||o.id==="null")&&(o.id=-1),o.events?.onEditorCloseCallback&&typeof o.events.onEditorCloseCallback=="function"&&(o.editorGoBack="event");let e=`/doceditor?fileId=${o.id}&editorType=${o.editorType}&action=view`;return o.requestToken?`${e}&share=${o.requestToken}&is_file=true`:e}default:return o.rootPath}};var d=class{#r=!1;#a="0";#t=[];#o=[];#s="";config;constructor(e){this.config=e}#l=e=>{let t=document.createElement("div"),s=document.createElement("div"),r=document.createElement("style"),n=e.frameId+"-loader__element",i=T(n);return s.className=n,t.id=e.frameId+"-loader",t.style.width=e.width,t.style.height=e.height,t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",r.insertAdjacentHTML("afterbegin",i),t.append(r,s),t};#m=e=>{let t=document.createElement("iframe"),s=E(e);return t.id=e.frameId,t.src=e.src+s,t.name=f+"__#"+e.frameId,t.style.width=e.width,t.style.height=e.height,t.style.border="0px",t.allowFullscreen=!0,t.setAttribute("allow","storage-access *"),e.type=="mobile"&&(t.style.position="fixed",t.style.overflow="hidden",document.body.style.overscrollBehaviorY="contain"),e.checkCSP&&b(e.src).catch(r=>{e.events?.onAppError?.(r.message);let n=w(e.src);t.srcdoc=n,this.setIsLoaded()}),t};#n=e=>{let t=document.getElementById(this.config.frameId);t?.contentWindow&&t.contentWindow.postMessage(JSON.stringify({frameId:this.config.frameId,type:"",data:e},(s,r)=>typeof r=="function"?r.toString():r),this.config.src)};#i=e=>{if(typeof e.data=="string")try{let t=this.#c(e.data);if(t.frameId!==this.config.frameId)return;({onMethodReturn:()=>this.#d(t),onEventReturn:()=>this.#h(t.eventReturnData),onCallCommand:()=>this.#u(t),error:()=>t.error&&this.#f(t.error)})[t.type]?.()}catch(t){console.error("Message handling error:",t)}};#c(e){try{return JSON.parse(e)}catch(t){return console.warn("Failed to parse message:",t),{frameId:"error",type:"error",commandName:"parseMessageData",error:{message:"Invalid message format"}}}}#d(e){this.#t.shift()?.(e.methodReturnData),this.#o.length>0&&this.#n(this.#o.shift())}#h(e){if(!e?.event)return;let t=e.event,s=this.config.events?.[t];if(typeof s=="function")try{s(e.data)}catch(r){console.error("Event handler failed:",t,r)}}#u(e){let t=this[e.commandName];typeof t=="function"&&t.call(this,e.commandData)}#f(e){console.error("SDK Error:",e),this.config.events?.onAppError?.(e.message)}#g(e,t,s){if(!this.#r)return this.config.events?.onAppError?.(p),console.error(p);this.#t=[...this.#t,s];let r={type:"method",methodName:e,data:t};this.#t.length>1?this.#o=[...this.#o,r]:this.#n(r)}setIsLoaded(){let e=document.getElementById(this.config.frameId),t=document.getElementById(this.config.frameId+"-loader");e&&(e.style.opacity="1",e.style.position="relative",e.style.width=this.config.width,e.style.height=this.config.height,e.parentNode.style.height=this.config.height,t&&(t.remove(),this.config.events?.onContentReady?.()))}initFrame(e){this.config={...this.config,...l,...e},this.config.src===""&&(console.log("Src not set, using dev environment"),this.config.src="https://sdk-ssr.onlyoffice.io"),this.config.mode==="manager"&&this.config.requestToken!==""&&(this.config.mode="public-room"),!this.config.noLoader&&(this.config.mode==="public-room"||this.config.mode==="room-selector"||this.config.mode==="file-selector")&&(this.config.noLoader=!0);let t=document.getElementById(this.config.frameId);if(!t)return null;this.#s=t.className;let s=document.createDocumentFragment(),r=document.createElement("div");Object.assign(r,{id:this.config.frameId+"-container",className:"frame-container"}),Object.assign(r.style,{position:"relative",width:this.config.width,height:this.config.height});let n=this.#m(this.config);if(Object.assign(n.style,{opacity:this.config.noLoader?"1":this.#a,zIndex:"2",position:this.config.noLoader?"relative":"absolute",width:"100%",height:"100%",top:"0",left:"0"}),(!this.config.waiting||this.config.mode==="system")&&s.appendChild(n),!this.config.noLoader){let m=this.#l(this.config);s.appendChild(m)}return r.appendChild(s),t.parentNode?.isEqualNode(document.getElementById(this.config.frameId+"-container"))?t.parentNode?.replaceWith(r):t.replaceWith(r),window.addEventListener("message",this.#i,!1),this.#r=!0,window.DocSpace.SDK.frames=window.DocSpace.SDK.frames||{},window.DocSpace.SDK.frames[this.config.frameId]=this,n}destroyFrame(){let e=this.config.frameId,t=document.getElementById(e);if(t){let s=document.createElement("div");s.id=e,s.className=this.#s,s.innerHTML=this.config.destroyText||"",t.replaceWith(s)}window.removeEventListener("message",this.#i,!1),this.#r=!1,window.DocSpace?.SDK?.frames&&delete window.DocSpace.SDK.frames[e]}#e=(e,t=null)=>new Promise(s=>{this.#g(e,t,r=>s(r))});setConfig(e=l){return this.config={...this.config,...e},this.#e("setConfig",this.config)}getConfig(){return this.config}getFolderInfo(){return this.#e("getFolderInfo")}getSelection(){return this.#e("getSelection")}getFiles(){return this.#e("getFiles")}getFolders(){return this.#e("getFolders")}getList(){return this.#e("getList")}getRooms(e){return this.#e("getRooms",e)}getUserInfo(){return this.#e("getUserInfo")}getHashSettings(){return this.#e("getHashSettings")}openModal(e,t){return this.#e("openModal",{type:e,options:t})}createFile(e,t,s,r){return this.#e("createFile",{folderId:e,title:t,templateId:s,formId:r})}createFolder(e,t){return this.#e("createFolder",{parentFolderId:e,title:t})}createRoom(e,t,s,r,n,i,m,a){return this.#e("createRoom",{title:e,roomType:t,...s!==void 0&&{quota:s},...a!==void 0&&{denyDownload:a},...r!==void 0&&{tags:r},...n!==void 0&&{color:n},...i!==void 0&&{cover:i},...m!==void 0&&{indexing:m}})}setListView(e){return this.#e("setListView",{viewType:e})}createHash(e,t){return this.#e("createHash",{password:e,hashSettings:t})}login(e,t,s,r){return this.#e("login",{email:e,passwordHash:t,...s!==void 0&&{password:s},...r!==void 0&&{session:r}})}logout(){return this.#e("logout")}createTag(e){return this.#e("createTag",{name:e})}addTagsToRoom(e,t){return this.#e("addTagsToRoom",{roomId:e,tags:t})}removeTagsFromRoom(e,t){return this.#e("removeTagsFromRoom",{roomId:e,tags:t})}getEditorInstance(){return this.#e("getEditorInstance")}};var h=class{instances=[];frames={};init=e=>{let{frameId:t}=e,s=this.frames[t];if(s)return s.initFrame(e),s;let r=new d(e);return r.initFrame(e),this.frames[t]=r,this.instances.push(r),r};initFrame=e=>this.init(e);initManager=e=>this.init({...e,mode:"manager"});initViewer=e=>this.init({...e,mode:"viewer"});initEditor=e=>this.init({...e,mode:"editor"});initRoomSelector=e=>this.init({...e,mode:"room-selector"});initFileSelector=e=>this.init({...e,mode:"file-selector"});initSystem=e=>this.init({...e,mode:"system"})};window.DocSpace=window.DocSpace||{};var v=S();window.DocSpace.SDK=window.DocSpace.SDK||new h;v?.init&&window.DocSpace.SDK.init(v);})();
