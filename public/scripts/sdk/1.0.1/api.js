"use strict";(()=>{var b="/api/2.0/security/csp",f="frameDocSpace",l={src:"",rootPath:"/rooms/shared/",requestToken:null,width:"100%",height:"100%",name:f,type:"desktop",frameId:"ds-frame",mode:"manager",id:null,locale:null,theme:"System",editorType:"desktop",editorGoBack:!0,selectorType:"all",showSelectorCancel:!1,showSelectorHeader:!1,showHeader:!1,showHeaderBanner:"none",showTitle:!0,showMenu:!1,showFilter:!1,showSignOut:!0,destroyText:"",viewAs:"row",viewTableColumns:"Index,Name,Size,Type,Tags",checkCSP:!0,disableActionButton:!1,showSettings:!1,waiting:!1,noLoader:!1,withSearch:!0,withBreadCrumbs:!0,withSubtitle:!0,filterParam:"ALL",buttonColor:"#5299E0",infoPanelVisible:!0,downloadToEvent:!1,filter:{count:"100",page:"1",sortOrder:"descending",sortBy:"DateAndTime",search:"",withSubfolders:!1},editorCustomization:{},events:{onSelectCallback:null,onCloseCallback:null,onAppReady:null,onAppError:null,onEditorCloseCallback:null,onAuthSuccess:null,onSignOut:null,onDownload:null,onNoAccess:null,onNotFound:null,onContentReady:null,onEditorOpen:null}},g="The current domain is not set in the Content Security Policy (CSP) settings.",p="Message bus is not connected with frame";var d=r=>r?(Object.keys(r).forEach(e=>(r[e]===void 0||r[e]===null)&&delete r[e]),new URLSearchParams(r).toString()):"",y=async r=>{let{origin:e,host:t}=window.location;if(e.includes(r))return;let o=await fetch(`${r}${b}`,{method:"get",headers:new Headers({"ngrok-skip-browser-warning":"69420"})}),s;try{s=await o.json()}catch(a){throw new Error(`CSP validation failed: ${a}`)}let{response:{domains:n}}=s,i=t||new URL(e).host;if(!n.map(a=>{try{let u=new URL(a.toLowerCase());return u.host+(u.pathname!=="/"?u.pathname:"")}catch{return a}}).includes(i.toLowerCase()))throw new Error(g)},w=r=>`<body style=background:#f3f4f4><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300"rel=stylesheet><div style="display:flex;flex-direction:column;gap:80px;align-items:center;justify-content:flex-start;margin-top:60px;padding:0 30px"><div style=flex-shrink:0;width:211px;height:24px;position:relative><img src=${r}/static/images/logo/lightsmall.svg></div><div style=display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:flex-start;flex-shrink:0;position:relative><div style=flex-shrink:0;width:120px;height:100px;position:relative><img src=${r}/static/images/frame-error.svg></div><span style="color:#a3a9ae;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px">${g} Please add it via <a href=${r}/portal-settings/developer-tools/javascript-sdk style="color:#4781d1;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px;text-decoration-line:underline"target=_blank>the Developer Tools section</a>.</span></div></div></body>`,T=r=>`@keyframes rotate { 0%{ transform: rotate(-45deg); } 15%{ transform: rotate(45deg); } 30%{ transform: rotate(135deg); } 45%{ transform: rotate(225deg); } 60%, 100%{ transform: rotate(315deg); } } .${r} { width: 74px; height: 74px; border: 4px solid rgba(51,51,51, 0.1); border-top-color: #333333; border-radius: 50%; transform: rotate(-45deg); position: relative; box-sizing: border-box; animation: 1s linear infinite rotate; } @media (prefers-color-scheme: dark) { .${r} { border-color: rgba(204, 204, 204, 0.1); border-top-color: #CCCCCC; } }`,S=()=>{let r=document.currentScript,e=new URL(decodeURIComponent(r.src)).searchParams,t={...l};return e.forEach((o,s)=>{let n=o==="true"?!0:o==="false"?!1:o;l.filter&&s in l.filter?t.filter[s]=n:t[s]=n}),t.mode=e.get("mode")||"manager",t.src=e.get("src")||new URL(decodeURIComponent(r.src)).origin,t},E=r=>{switch(r.mode){case"manager":{r.id&&(r.filter.folder=r.id);let e=r.requestToken?{key:r.requestToken,...r.filter}:r.filter;e?.withSubfolders||delete e?.withSubfolders;let t=d(e);return`${r.rootPath}${r.requestToken?`?${t}`:`${r.id?r.id+"/":""}filter?${t}`}`}case"room-selector":{let e={acceptLabel:r.acceptButtonLabel,cancel:r.showSelectorCancel,cancelLabel:r.cancelButtonLabel,header:r.showSelectorHeader,locale:r.locale,roomType:r.roomType,search:r.withSearch,theme:r.theme},t=d(e);return`/sdk/room-selector${t?`?${t}`:""}`}case"file-selector":{let e={acceptLabel:r.acceptButtonLabel,breadCrumbs:r.withBreadCrumbs,cancel:r.showSelectorCancel,cancelLabel:r.cancelButtonLabel,filter:r.filterParam,header:r.showSelectorHeader,id:r.id,locale:r.locale,roomType:r.roomType,search:r.withSearch,selectorType:r.selectorType,subtitle:r.withSubtitle,theme:r.theme},t=d(e);return`/sdk/file-selector${t?`?${t}`:""}`}case"public-room":{let e={theme:r.theme,locale:r.locale,folder:r.id,key:r.requestToken},t=d(e);return`/sdk/public-room${t?`?${t}`:""}`}case"system":return"/old-sdk/system";case"editor":{let e={locale:r.locale,theme:r.theme,fileId:!r.id||r.id==="undefined"||r.id==="null"?-1:r.id,editorType:r.editorType};r.events?.onEditorCloseCallback&&typeof r.events.onEditorCloseCallback=="function"&&(e.editorGoBack="event"),r.requestToken&&(e.share=r.requestToken,e.is_file=!0);let t=d(e);return`/doceditor${t?`?${t}`:""}`}case"viewer":{r?.editorCustomization&&((r?.editorCustomization).uiTheme=r.theme),(!r.id||r.id==="undefined"||r.id==="null")&&(r.id=-1),r.events?.onEditorCloseCallback&&typeof r.events.onEditorCloseCallback=="function"&&(r.editorGoBack="event");let e=`/doceditor?fileId=${r.id}&editorType=${r.editorType}&action=view`;return r.requestToken?`${e}&share=${r.requestToken}&is_file=true`:e}default:return r.rootPath}};var c=class{#o=!1;#a="0";#t=[];#r=[];#s="";config;constructor(e){this.config=e}#l=e=>{let t=document.createElement("div"),o=document.createElement("div"),s=document.createElement("style"),n=e.frameId+"-loader__element",i=T(n);return o.className=n,t.id=e.frameId+"-loader",t.style.width=e.width,t.style.height=e.height,t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",s.insertAdjacentHTML("afterbegin",i),t.append(s,o),t};#m=e=>{let t=document.createElement("iframe"),o=E(e);return t.id=e.frameId,t.src=e.src+o,t.name=f+"__#"+e.frameId,t.style.width=e.width,t.style.height=e.height,t.style.border="0px",t.allowFullscreen=!0,t.setAttribute("allow","storage-access *"),e.type=="mobile"&&(t.style.position="fixed",t.style.overflow="hidden",document.body.style.overscrollBehaviorY="contain"),e.checkCSP&&y(e.src).catch(s=>{e.events?.onAppError?.(s.message);let n=w(e.src);t.srcdoc=n,this.setIsLoaded()}),t};#n=e=>{let t=document.getElementById(this.config.frameId);t?.contentWindow&&t.contentWindow.postMessage(JSON.stringify({frameId:this.config.frameId,type:"",data:e},(o,s)=>typeof s=="function"?s.toString():s),this.config.src)};#i=e=>{if(typeof e.data=="string")try{let t=this.#d(e.data);if(t.frameId!==this.config.frameId)return;({onMethodReturn:()=>this.#c(t),onEventReturn:()=>this.#h(t.eventReturnData),onCallCommand:()=>this.#u(t),error:()=>t.error&&this.#f(t.error)})[t.type]?.()}catch(t){console.error("Message handling error:",t)}};#d(e){try{return JSON.parse(e)}catch(t){return console.warn("Failed to parse message:",t),{frameId:"error",type:"error",commandName:"parseMessageData",error:{message:"Invalid message format"}}}}#c(e){this.#t.shift()?.(e.methodReturnData),this.#r.length>0&&this.#n(this.#r.shift())}#h(e){if(!e?.event)return;let t=e.event,o=this.config.events?.[t];if(typeof o=="function")try{o(e.data)}catch(s){console.error("Event handler failed:",t,s)}}#u(e){let t=this[e.commandName];typeof t=="function"&&t.call(this,e.commandData)}#f(e){console.error("SDK Error:",e),this.config.events?.onAppError?.(e.message)}#g(e,t,o){if(!this.#o)return this.config.events?.onAppError?.(p),console.error(p);this.#t=[...this.#t,o];let s={type:"method",methodName:e,data:t};this.#t.length>1?this.#r=[...this.#r,s]:this.#n(s)}setIsLoaded(){let e=document.getElementById(this.config.frameId),t=document.getElementById(this.config.frameId+"-loader");e&&(e.style.opacity="1",e.style.position="relative",e.style.width=this.config.width,e.style.height=this.config.height,e.parentNode.style.height=this.config.height,t&&(t.remove(),this.config.events?.onContentReady?.()))}initFrame(e){this.config={...this.config,...l,...e};let t=document.getElementById(this.config.frameId);if(!t)return null;this.#s=t.className;let o=document.createDocumentFragment(),s=document.createElement("div");Object.assign(s,{id:this.config.frameId+"-container",className:"frame-container"}),Object.assign(s.style,{position:"relative",width:this.config.width,height:this.config.height});let n=this.#m(this.config);if(Object.assign(n.style,{opacity:this.config.noLoader?"1":this.#a,zIndex:"2",position:this.config.noLoader?"relative":"absolute",width:"100%",height:"100%",top:"0",left:"0"}),(!this.config.waiting||this.config.mode==="system")&&o.appendChild(n),!this.config.noLoader){let m=this.#l(this.config);o.appendChild(m)}return s.appendChild(o),t.parentNode?.isEqualNode(document.getElementById(this.config.frameId+"-container"))?t.parentNode?.replaceWith(s):t.replaceWith(s),window.addEventListener("message",this.#i,!1),this.#o=!0,window.DocSpace.SDK.frames=window.DocSpace.SDK.frames||{},window.DocSpace.SDK.frames[this.config.frameId]=this,n}destroyFrame(){let e=this.config.frameId,t=document.getElementById(e);if(t){let o=document.createElement("div");o.id=e,o.className=this.#s,o.innerHTML=this.config.destroyText||"",t.replaceWith(o)}window.removeEventListener("message",this.#i,!1),this.#o=!1,window.DocSpace?.SDK?.frames&&delete window.DocSpace.SDK.frames[e]}#e=(e,t=null)=>new Promise(o=>{this.#g(e,t,s=>o(s))});setConfig(e=l){return this.config={...this.config,...e},this.#e("setConfig",this.config)}getConfig(){return this.config}getFolderInfo(){return this.#e("getFolderInfo")}getSelection(){return this.#e("getSelection")}getFiles(){return this.#e("getFiles")}getFolders(){return this.#e("getFolders")}getList(){return this.#e("getList")}getRooms(e){return this.#e("getRooms",e)}getUserInfo(){return this.#e("getUserInfo")}getHashSettings(){return this.#e("getHashSettings")}openModal(e,t){return this.#e("openModal",{type:e,options:t})}createFile(e,t,o,s){return this.#e("createFile",{folderId:e,title:t,templateId:o,formId:s})}createFolder(e,t){return this.#e("createFolder",{parentFolderId:e,title:t})}createRoom(e,t,o,s,n,i,m,a){return this.#e("createRoom",{title:e,roomType:t,...o!==void 0&&{quota:o},...a!==void 0&&{denyDownload:a},...s!==void 0&&{tags:s},...n!==void 0&&{color:n},...i!==void 0&&{cover:i},...m!==void 0&&{indexing:m}})}setListView(e){return this.#e("setListView",{viewType:e})}createHash(e,t){return this.#e("createHash",{password:e,hashSettings:t})}login(e,t,o,s){return this.#e("login",{email:e,passwordHash:t,...o!==void 0&&{password:o},...s!==void 0&&{session:s}})}logout(){return this.#e("logout")}createTag(e){return this.#e("createTag",{name:e})}addTagsToRoom(e,t){return this.#e("addTagsToRoom",{roomId:e,tags:t})}removeTagsFromRoom(e,t){return this.#e("removeTagsFromRoom",{roomId:e,tags:t})}getEditorInstance(){return this.#e("getEditorInstance")}};var h=class{instances=[];frames={};init=e=>{let{frameId:t}=e,o=this.frames[t];if(o)return o.initFrame(e),o;let s=new c(e);return s.initFrame(e),this.frames[t]=s,this.instances.push(s),s};initFrame=e=>this.init(e);initManager=e=>this.init({...e,mode:"manager"});initViewer=e=>this.init({...e,mode:"viewer"});initEditor=e=>this.init({...e,mode:"editor"});initRoomSelector=e=>this.init({...e,mode:"room-selector"});initFileSelector=e=>this.init({...e,mode:"file-selector"});initSystem=e=>this.init({...e,mode:"system"})};window.DocSpace=window.DocSpace||{};var v=S();window.DocSpace.SDK=window.DocSpace.SDK||new h;v?.init&&window.DocSpace.SDK.init(v);})();
