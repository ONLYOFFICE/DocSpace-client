"use strict";(()=>{var C="/api/2.0/security/csp",g="frameDocSpace",m={src:"",rootPath:"/rooms/shared/",requestToken:null,width:"100%",height:"100%",name:g,type:"desktop",frameId:"ds-frame",mode:"manager",id:null,locale:null,theme:"System",editorType:"desktop",editorGoBack:!0,selectorType:"all",showSelectorCancel:!1,showSelectorHeader:!1,showHeader:!1,showHeaderBanner:"none",showTitle:!0,showMenu:!1,showFilter:!1,showSignOut:!0,destroyText:"",viewAs:"row",viewTableColumns:"Index,Name,Size,Type,Tags",checkCSP:!0,disableActionButton:!1,showSettings:!1,waiting:!1,noLoader:!0,withSearch:!0,withBreadCrumbs:!0,withSubtitle:!0,filterParam:"ALL",buttonColor:"#5299E0",infoPanelVisible:!0,downloadToEvent:!1,filter:{count:"100",page:"1",sortOrder:"descending",sortBy:"DateAndTime",search:"",withSubfolders:!1},editorCustomization:{},events:{onSelectCallback:null,onCloseCallback:null,onAppReady:null,onAppError:null,onEditorCloseCallback:null,onAuthSuccess:null,onSignOut:null,onDownload:null,onNoAccess:null,onNotFound:null,onContentReady:null,onEditorOpen:null}},u="The current domain is not set in the Content Security Policy (CSP) settings.",b="Message bus is not connected with frame";var c=o=>o?(Object.keys(o).forEach(e=>(o[e]===void 0||o[e]===null)&&delete o[e]),new URLSearchParams(o).toString()):"",w=async o=>{let{origin:e,host:t}=window.location;if(e.includes(o))return;let n=await fetch(`${o}${C}`,{method:"get",headers:new Headers({"ngrok-skip-browser-warning":"69420"})}),r;try{r=await n.json()}catch(a){throw new Error(`CSP validation failed: ${a}`)}let{response:{domains:i}}=r,l=t||new URL(e).host;if(!i.map(a=>{try{let d=new URL(a.toLowerCase());return d.host+(d.pathname!=="/"?d.pathname:"")}catch{return a}}).includes(l.toLowerCase()))throw new Error(u)},y=o=>`<body style=background:#f3f4f4><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300"rel=stylesheet><div style="display:flex;flex-direction:column;gap:80px;align-items:center;justify-content:flex-start;margin-top:60px;padding:0 30px"><div style=flex-shrink:0;width:211px;height:24px;position:relative><img src=${o}/static/images/logo/lightsmall.svg></div><div style=display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:flex-start;flex-shrink:0;position:relative><div style=flex-shrink:0;width:120px;height:100px;position:relative><img src=${o}/static/images/frame-error.svg></div><span style="color:#a3a9ae;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px">${u} Please add it via <a href=${o}/portal-settings/developer-tools/javascript-sdk style="color:#4781d1;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px;text-decoration-line:underline"target=_blank>the Developer Tools section</a>.</span></div></div></body>`,T=o=>`
@keyframes rotate { 
  0%{ transform: rotate(-45deg); will-change: transform; } 
  15%{ transform: rotate(45deg); } 
  30%{ transform: rotate(135deg); } 
  45%{ transform: rotate(225deg); } 
  60%, 100%{ transform: rotate(315deg); } 
} 
.${o} { 
  width: 74px; 
  height: 74px; 
  border: 4px solid rgba(51,51,51, 0.1); 
  border-top-color: #333333; 
  border-radius: 50%; 
  transform: rotate(-45deg); 
  position: relative; 
  box-sizing: border-box; 
  animation: 1s linear infinite rotate; 
  will-change: transform;
} 
@media (prefers-color-scheme: dark) { 
  .${o} { 
    border-color: rgba(204, 204, 204, 0.1); 
    border-top-color: #CCCCCC; 
  } 
}
@media (prefers-reduced-motion: reduce) {
  .${o} {
    animation-duration: 1.5s;
  }
}`,v=()=>{let o=document.currentScript,e=new URL(decodeURIComponent(o.src)).searchParams,t={...m};return e.forEach((n,r)=>{let i=n==="true"?!0:n==="false"?!1:n;m.filter&&r in m.filter?t.filter[r]=i:t[r]=i}),t.mode=e.get("mode")||"manager",t.src=e.get("src")||"",t},E=o=>{let e={theme:o.theme,locale:o.locale},t={acceptLabel:o.acceptButtonLabel,cancel:o.showSelectorCancel,cancelLabel:o.cancelButtonLabel,header:o.showSelectorHeader,roomType:o.roomType,search:o.withSearch},n={fileId:!o.id||o.id==="undefined"||o.id==="null"?-1:o.id,editorType:o.editorType,share:o.requestToken?o.requestToken:void 0,is_file:o.requestToken?!0:void 0};switch(o.mode){case"manager":{o.id&&(o.filter.folder=o.id);let r=o.requestToken?{key:o.requestToken,...o.filter}:o.filter;r?.withSubfolders||delete r?.withSubfolders;let i=c(r);return`${o.rootPath}${o.requestToken?`?${i}`:`${o.id?o.id+"/":""}filter?${i}`}`}case"room-selector":{let r={...e,...t},i=c(r);return`/sdk/room-selector${i?`?${i}`:""}`}case"file-selector":{let r={...e,...t,breadCrumbs:o.withBreadCrumbs,filter:o.filterParam,id:o.id,selectorType:o.selectorType,subtitle:o.withSubtitle},i=c(r);return`/sdk/file-selector${i?`?${i}`:""}`}case"public-room":{let r={...e,folder:o.id,key:o.requestToken},i=c(r);return`/sdk/public-room${i?`?${i}`:""}`}case"system":{let r=c(e);return`/old-sdk/system${r?`?${r}`:""}`}case"editor":{let r={...e,...n};o.events?.onEditorCloseCallback&&typeof o.events.onEditorCloseCallback=="function"&&(r.editorGoBack="event");let i=c(r);return`/doceditor${i?`?${i}`:""}`}case"viewer":{let r={...e,...n,action:"view"};o.events?.onEditorCloseCallback&&typeof o.events.onEditorCloseCallback=="function"&&(r.editorGoBack="event");let i=c(r);return`/doceditor${i?`?${i}`:""}`}default:return o.rootPath||"/"}};var h=class o{#r=!1;#t=[];#o=[];#n="";config;constructor(e){this.config=e}static _loaderCache={style:new Map,container:document.createElement("div"),templates:new Map};static _iframeCache;#l=e=>{let{frameId:t,width:n,height:r}=e,i=`${t}-loader__element`,l=`${n}_${r}`;if(!o._loaderCache.style.has(i)){let a=document.createElement("style");a.textContent=T(i);let d=document.createDocumentFragment();d.appendChild(a),document.head.appendChild(d),o._loaderCache.style.set(i,a)}let s;if(o._loaderCache.templates.has(l))s=o._loaderCache.templates.get(l).cloneNode(!0),s.id=`${t}-loader`;else{s=o._loaderCache.container.cloneNode(),Object.assign(s.style,{width:n,height:r,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"1",backgroundColor:"transparent",transition:"opacity 0.15s ease-out"});let a=document.createElement("div");a.className=i,s.appendChild(a),o._loaderCache.templates.set(l,s.cloneNode(!0)),s.id=`${t}-loader`}return s};#m=e=>{o._iframeCache||(o._iframeCache={template:document.createElement("iframe"),pathCache:new Map},o._iframeCache.template.allowFullscreen=!0,o._iframeCache.template.setAttribute("allow","storage-access *"));let t=o._iframeCache.template.cloneNode(),n=`${e.mode}_${e.id||""}_${e.frameId}`,r=o._iframeCache.pathCache.get(n);return r||(r=E(e),o._iframeCache.pathCache.set(n,r)),t.id=e.frameId,t.name=`${g}__#${e.frameId}`,t.src=e.src+r,Object.assign(t.style,{width:e.width,height:e.height,border:"0px",opacity:"0",...e.type==="mobile"&&{position:"fixed",overflow:"hidden",webkitOverflowScrolling:"touch"}}),e.type==="mobile"&&(document.body.style.overscrollBehaviorY="contain","loading"in HTMLIFrameElement.prototype&&(t.loading="eager")),e.checkCSP&&requestAnimationFrame(()=>{w(e.src).catch(i=>{e.events?.onAppError&&e.events.onAppError(i.message),t.srcdoc=y(e.src),this.setIsLoaded()})}),t};setIsLoaded(){let e=this.config.frameId,t=document.getElementById(e),n=t?.parentElement;!t||!n||requestAnimationFrame(()=>{n.style.height=this.config.height;let r=document.getElementById(`${e}-loader`);if(r){r.style.opacity="0";let i=()=>{r.parentNode&&r.parentNode.removeChild(r),this.config.events?.onContentReady?.()};requestAnimationFrame(()=>{i()})}else this.config.events?.onContentReady?.();requestAnimationFrame(()=>{Object.assign(t.style,{opacity:"1",position:"relative",width:this.config.width,height:this.config.height})})})}#i=e=>{let t=document.getElementById(this.config.frameId);t?.contentWindow&&t.contentWindow.postMessage(JSON.stringify({frameId:this.config.frameId,type:"",data:e},(n,r)=>typeof r=="function"?r.toString():r),this.config.src)};#s=e=>{if(typeof e.data!="string")return;let t=this.#c(e.data);if(t.frameId===this.config.frameId)switch(t.type){case"onMethodReturn":this.#d(t);break;case"onEventReturn":t.eventReturnData&&this.#h(t.eventReturnData);break;case"onCallCommand":this.#f(t);break;case"error":t.error&&this.#a(t.error);break}};#c(e){try{return JSON.parse(e)}catch(t){return console.warn("Failed to parse message:",t),{frameId:"error",type:"error",commandName:"parseMessageData",error:{message:"Invalid message format"}}}}#d(e){this.#t.shift()?.(e.methodReturnData),this.#o.length>0&&this.#i(this.#o.shift())}#h(e){if(!e?.event)return;let t=e.event,n=this.config.events?.[t];if(typeof n=="function")try{n(e.data)}catch(r){console.error("Event handler failed:",t,r)}}#f(e){let t=this[e.commandName];typeof t=="function"&&t.call(this,e.commandData)}#a(e){console.error("SDK Error:",e),this.config.events?.onAppError?.(e.message)}#g(e,t,n){if(!this.#r){this.#a({message:b});return}this.#t=[...this.#t,n];let r={type:"method",methodName:e,data:t};this.#t.length>1?this.#o=[...this.#o,r]:this.#i(r)}initFrame(e){this.config={...this.config,...m,...e};let t=document.getElementById(this.config.frameId);if(!t)return null;(this.config.mode==="manager"||this.config.mode==="system")&&(this.config.noLoader=!1),this.#n=t.className;let n=document.createDocumentFragment(),r=document.createElement("div");Object.assign(r,{id:this.config.frameId+"-container",className:"frame-container",style:{position:"relative",width:this.config.width,height:this.config.height}});let i=this.#m(this.config);Object.assign(i.style,{opacity:this.config.noLoader?"1":"0",zIndex:"2",position:this.config.noLoader?"relative":"absolute",width:this.config.noLoader?this.config.width:"100%",height:this.config.noLoader?this.config.height:"100%",top:"0",left:"0"});let l=()=>{window.addEventListener("message",this.#s.bind(this)),this.#r=!0,this.config.noLoader&&this.config.events?.onContentReady?.(),i.removeEventListener("load",l)};if(i.addEventListener("load",l),(!this.config.waiting||this.config.mode==="system")&&n.appendChild(i),!this.config.noLoader){let s=this.#l(this.config);n.appendChild(s)}return r.appendChild(n),t.parentNode?(t.parentNode.insertBefore(r,t),t.remove()):t.replaceWith(r),window.DocSpace.SDK.frames=window.DocSpace.SDK.frames||{},window.DocSpace.SDK.frames[this.config.frameId]=this,i}destroyFrame(){let e=this.config.frameId,t=document.getElementById(e),n=window.DocSpace?.SDK?.frames;t&&(t.innerHTML=this.config.destroyText||"",t.className=this.#n,t.replaceWith(t.cloneNode(!1))),window.removeEventListener("message",this.#s,!1),this.#r=!1,n&&delete n[e]}#e=(e,t=null)=>new Promise(n=>{this.#g(e,t,r=>n(r))});setConfig(e=m){return this.config={...this.config,...e},this.#e("setConfig",this.config)}getConfig(){return this.config}getFolderInfo(){return this.#e("getFolderInfo")}getSelection(){return this.#e("getSelection")}getFiles(){return this.#e("getFiles")}getFolders(){return this.#e("getFolders")}getList(){return this.#e("getList")}getRooms(e){return this.#e("getRooms",e)}getUserInfo(){return this.#e("getUserInfo")}getHashSettings(){return this.#e("getHashSettings")}openModal(e,t){return this.#e("openModal",{type:e,options:t})}createFile(e,t,n,r){return this.#e("createFile",{folderId:e,title:t,templateId:n,formId:r})}createFolder(e,t){return this.#e("createFolder",{parentFolderId:e,title:t})}createRoom(e,t,n,r,i,l,s,a){return this.#e("createRoom",{title:e,roomType:t,...n!==void 0&&{quota:n},...a!==void 0&&{denyDownload:a},...r!==void 0&&{tags:r},...i!==void 0&&{color:i},...l!==void 0&&{cover:l},...s!==void 0&&{indexing:s}})}setListView(e){return this.#e("setListView",{viewType:e})}createHash(e,t){return this.#e("createHash",{password:e,hashSettings:t})}login(e,t,n,r){return this.#e("login",{email:e,passwordHash:t,...n!==void 0&&{password:n},...r!==void 0&&{session:r}})}logout(){return this.#e("logout")}createTag(e){return this.#e("createTag",{name:e})}addTagsToRoom(e,t){return this.#e("addTagsToRoom",{roomId:e,tags:t})}removeTagsFromRoom(e,t){return this.#e("removeTagsFromRoom",{roomId:e,tags:t})}getEditorInstance(){return this.#e("getEditorInstance")}};var f=class{frames={};init=e=>{let{frameId:t}=e,n=this.frames[t];if(n)return n.initFrame(e),n;let r=new h(e);return r.initFrame(e),this.frames[t]=r,r};initFrame=e=>this.init(e);initManager=e=>this.init({...e,mode:"manager"});initViewer=e=>this.init({...e,mode:"viewer"});initEditor=e=>this.init({...e,mode:"editor"});initRoomSelector=e=>this.init({...e,mode:"room-selector"});initFileSelector=e=>this.init({...e,mode:"file-selector"});initSystem=e=>this.init({...e,mode:"system"})};window.DocSpace=window.DocSpace||{};var F=v();window.DocSpace.SDK=window.DocSpace.SDK||new f;F?.init&&window.DocSpace.SDK.init(F);})();
/**
 * (c) Copyright Ascensio System SIA 2024
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @license
 */
