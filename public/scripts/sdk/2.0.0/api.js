"use strict";(()=>{var S="/api/2.0/security/csp",b="frameDocSpace",h={src:"",rootPath:"/rooms/shared/",requestToken:null,width:"100%",height:"100%",name:b,type:"desktop",frameId:"ds-frame",mode:"manager",id:null,locale:null,theme:"System",editorType:"desktop",editorGoBack:!0,selectorType:"all",showSelectorCancel:!1,showSelectorHeader:!1,showHeader:!0,showHeaderBanner:"none",showTitle:!0,showMenu:!1,showFilter:!1,showSignOut:!0,destroyText:"",viewAs:"row",viewTableColumns:"Index,Name,Size,Type,Tags",checkCSP:!0,disableActionButton:!1,showSettings:!1,waiting:!1,noLoader:!0,withSearch:!0,withBreadCrumbs:!0,withSubtitle:!0,filterParam:"ALL",buttonColor:"#5299E0",infoPanelVisible:!0,downloadToEvent:!1,filter:{count:"100",page:"1",sortOrder:"descending",sortBy:"DateAndTime",search:"",withSubfolders:!1},editorCustomization:{},events:{onSelectCallback:null,onCloseCallback:null,onAppReady:null,onAppError:null,onEditorCloseCallback:null,onAuthSuccess:null,onSignOut:null,onDownload:null,onNoAccess:null,onNotFound:null,onContentReady:null,onEditorOpen:null}},T="The current domain is not set in the Content Security Policy (CSP) settings.",x="Message bus is not connected with frame";var f=o=>o?(Object.keys(o).forEach(e=>(o[e]===void 0||o[e]===null)&&delete o[e]),new URLSearchParams(o).toString()):"",L=async o=>{let{origin:e,host:t}=window.location;if(e.includes(o))return;let n=await fetch(`${o}${S}`,{method:"get",headers:new Headers({"ngrok-skip-browser-warning":"69420"})}),r;try{r=await n.json()}catch(l){throw new Error(`CSP validation failed: ${l}`)}let{response:{domains:i}}=r,a=t||new URL(e).host;if(!i.map(l=>{try{let c=new URL(l.toLowerCase());return c.host+(c.pathname!=="/"?c.pathname:"")}catch{return l}}).includes(a.toLowerCase()))throw new Error(T)},P=o=>`<body style=background:#f3f4f4><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300"rel=stylesheet><div style="display:flex;flex-direction:column;gap:80px;align-items:center;justify-content:flex-start;margin-top:60px;padding:0 30px"><div style=flex-shrink:0;width:211px;height:24px;position:relative><img src=${o}/static/images/logo/lightsmall.svg></div><div style=display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:flex-start;flex-shrink:0;position:relative><div style=flex-shrink:0;width:120px;height:100px;position:relative><img src=${o}/static/images/frame-error.svg></div><span style="color:#a3a9ae;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px">${T} Please add it via <a href=${o}/portal-settings/developer-tools/javascript-sdk style="color:#4781d1;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px;text-decoration-line:underline"target=_blank>the Developer Tools section</a>.</span></div></div></body>`,R=o=>`@keyframes rotate { 0%{ transform: rotate(-45deg); will-change: transform; } 15%{ transform: rotate(45deg); } 30%{ transform: rotate(135deg); } 45%{ transform: rotate(225deg); } 60%, 100%{ transform: rotate(315deg); } } .${o} { width: 74px; height: 74px; border: 4px solid rgba(51,51,51, 0.1); border-top-color: #333333; border-radius: 50%; transform: rotate(-45deg); position: relative; box-sizing: border-box; animation: 1s linear infinite rotate; will-change: transform; } @media (prefers-color-scheme: dark) { .${o} { border-color: rgba(204, 204, 204, 0.1); border-top-color: #CCCCCC; } } @media (prefers-reduced-motion: reduce) { .${o} { animation-duration: 1.5s; } }`,k=()=>{let o=document.currentScript,e=new URL(decodeURIComponent(o.src)).searchParams,t={...h};return e.forEach((n,r)=>{let i=n==="true"?!0:n==="false"?!1:n;h.filter&&r in h.filter?t.filter[r]=i:t[r]=i}),t.mode=e.get("mode")||"manager",t.src=e.get("src")||"",t},$=o=>{let e={theme:o.theme,locale:o.locale},t={acceptLabel:o.acceptButtonLabel,cancel:o.showSelectorCancel,cancelLabel:o.cancelButtonLabel,header:o.showSelectorHeader,roomType:o.roomType,search:o.withSearch},n={fileId:!o.id||o.id==="undefined"||o.id==="null"?-1:o.id,editorType:o.editorType,share:o.requestToken?o.requestToken:void 0,is_file:o.requestToken?!0:void 0,editorGoBack:o.events?.onEditorCloseCallback&&typeof o.events.onEditorCloseCallback=="function"?"event":o.editorGoBack?o.editorGoBack:void 0};switch(o.mode){case"manager":{o.id&&(o.filter.folder=o.id);let r=o.requestToken?{key:o.requestToken,...o.filter}:o.filter;r?.withSubfolders||delete r?.withSubfolders;let i=f(r);return`${o.rootPath}${o.requestToken?`?${i}`:`${o.id?o.id+"/":""}filter?${i}`}`}case"room-selector":{let r={...e,...t},i=f(r);return`/sdk/room-selector${i?`?${i}`:""}`}case"file-selector":{let r={...e,...t,breadCrumbs:o.withBreadCrumbs,filter:o.filterParam,id:o.id,selectorType:o.selectorType,subtitle:o.withSubtitle},i=f(r);return`/sdk/file-selector${i?`?${i}`:""}`}case"public-room":{let r={...e,folder:o.id,key:o.requestToken,showFilter:o.showFilter,showHeader:o.showHeader,showTitle:o.showTitle},i=f(r);return`/sdk/public-room${i?`?${i}`:""}`}case"system":{let r=f(e);return`/old-sdk/system${r?`?${r}`:""}`}case"editor":{let r={...e,...n},i=f(r);return`/doceditor${i?`?${i}`:""}`}case"viewer":{let r={...e,...n,action:"view"},i=f(r);return`/doceditor${i?`?${i}`:""}`}default:return o.rootPath||"/"}};var C=class o{#n=!1;#t=[];#o=[];#i="";config;constructor(e){this.config=e}static _loaderCache={style:new Map,container:document.createElement("div"),templates:new Map};static _iframeCache;#c=e=>{let{frameId:t,width:n,height:r}=e,i=`${t}-loader__element`,a=`${n}_${r}`,s=o._loaderCache.style,l=o._loaderCache.templates;if(!s.has(i)){let m=document.createElement("style");m.textContent=R(i);let g=document.createDocumentFragment();g.appendChild(m),document.head.appendChild(g),s.set(i,m)}let c;if(l.has(a))c=l.get(a).cloneNode(!0),c.id=`${t}-loader`;else{c=o._loaderCache.container.cloneNode(),Object.assign(c.style,{width:n,height:r,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"1",backgroundColor:"transparent",transition:"opacity 0.15s ease-out"});let m=document.createElement("div");m.className=i,c.appendChild(m),l.set(a,c.cloneNode(!0)),c.id=`${t}-loader`}return c};#m=e=>{if(!o._iframeCache){let w=document.createElement("iframe");w.allowFullscreen=!0,w.setAttribute("allow","storage-access *"),o._iframeCache={template:w,pathCache:new Map,styleCache:new Map}}let{mode:t,id:n,frameId:r,type:i,width:a,height:s,src:l,events:c,checkCSP:m}=e,g=i==="mobile",d=o._iframeCache.template.cloneNode(),E=`${t}_${n||""}_${r}`,F=`${a}_${s}_${g?"mobile":"desktop"}`,u=o._iframeCache.pathCache.get(E);u||(u=$(e),o._iframeCache.pathCache.set(E,u)),d.id=r,d.name=`${b}__#${r}`,d.src=l+u;let p=o._iframeCache.styleCache.get(F);return p||(p={width:a,height:s,border:"0px",opacity:"0",...g&&{position:"fixed",overflow:"hidden",webkitOverflowScrolling:"touch"}},o._iframeCache.styleCache.set(F,p)),Object.assign(d.style,p),g&&(document.body.style.overscrollBehaviorY!=="contain"&&(document.body.style.overscrollBehaviorY="contain"),"loading"in HTMLIFrameElement.prototype&&(d.loading="eager")),m&&this.#d(d,l,c),d};#d(e,t,n){requestAnimationFrame(()=>{L(t).catch(r=>{n?.onAppError?.(r.message),e.srcdoc=P(t),this.setIsLoaded()})})}setIsLoaded(){let{frameId:e,width:t,height:n,events:r}=this.config,i=document.getElementById(e),a=i?.parentElement;!i||!a||requestAnimationFrame(()=>{try{a.style.width=t,a.style.height=n;let s=document.getElementById(`${e}-loader`);s?(s.style.opacity="0",requestAnimationFrame(()=>{try{s.parentNode&&s.parentNode.removeChild(s),r?.onContentReady?.()}catch(l){console.error("Error removing loader:",l),r?.onContentReady?.()}})):r?.onContentReady?.(),requestAnimationFrame(()=>{Object.assign(i.style,{opacity:"1",position:"relative",width:t,height:n})})}catch(s){console.error("Error in setIsLoaded:",s),r?.onContentReady?.()}})}#s=e=>{try{let{frameId:t,src:n}=this.config,r=document.getElementById(t);if(!r?.contentWindow)return;let i={frameId:t,type:"",data:e};r.contentWindow.postMessage(JSON.stringify(i,(a,s)=>typeof s=="function"?s.toString():s),n)}catch(t){this.#r(t)}};#a=e=>{try{if(typeof e.data!="string")return;let t=this.#h(e.data);if(t.frameId!==this.config.frameId)return;switch(t.type){case"onMethodReturn":this.#f(t);break;case"onEventReturn":t.eventReturnData&&this.#g(t.eventReturnData);break;case"onCallCommand":this.#u(t);break;case"error":t.error&&this.#r(t.error);break;default:console.warn("Unrecognized message type:",t.type)}}catch(t){this.#r(t)}};#h(e){try{let t=JSON.parse(e);if(!t||typeof t!="object"||!t.frameId)throw new Error("Invalid message structure");return t}catch(t){let n=t instanceof Error?t.message:"Unknown parsing error";return console.warn("Failed to parse message:",n),{frameId:"error",type:"error",commandName:"parseMessageData",error:{message:"Invalid message format: "+n}}}}#f(e){let t=this.#t.shift();if(t)try{t(e.methodReturnData||{})}catch(n){console.error("Error in callback execution:",n)}this.#o.length>0&&this.#s(this.#o.shift())}#g(e){if(!e?.event)return;let t=e.event,n=this.config.events?.[t];if(typeof n=="function")try{n(e.data||{})}catch(r){console.error(`Event handler '${t}' failed:`,r)}}#u(e){if(!e.commandName)return;let t=this[e.commandName];typeof t=="function"&&t.call(this,e.commandData)}#r(e){console.error("SDK Error:",e),this.config.events?.onAppError?.(e instanceof Error?e.message:"Unown error occurred")}#p(e,t,n){if(!this.#n&&e!=="setConfig"){this.#r({message:x});return}this.#t.push(n);let r={type:"method",methodName:e,data:t};this.#t.length>1?this.#o.push(r):this.#s(r)}#C(e){let t={...this.config,...h,...e};return(t.mode==="manager"||t.mode==="system")&&(t.noLoader=!1),t}#y(e){let t=document.getElementById(e);if(!t)return null;let n=document.getElementById(`${e}-container`);if(n){let r=n.parentNode;if(r){let i=document.createElement("div");i.id=e,r.replaceChild(i,n);let a=`${this.config.mode}_${this.config.id||""}_${this.config.frameId}`;return o._iframeCache.pathCache.delete(a),this.#l(i)}}return this.#i=t.className,this.#l(t)}#l(e){let t=document.createElement("div");return t.id=e.id+"-container",t.className="frame-container",Object.assign(t.style,{position:"relative",width:this.config.width,height:this.config.height}),{container:t,target:e}}#w(){let e=this.#m(this.config);return Object.assign(e.style,{opacity:this.config.noLoader?"1":"0",zIndex:"2",position:this.config.noLoader?"relative":"absolute",width:this.config.noLoader?this.config.width:"100%",height:this.config.noLoader?this.config.height:"100%",top:"0",left:"0"}),e}#b(e){let t=()=>{window.addEventListener("message",this.#a,!1),this.#n=!0,this.config.noLoader&&this.config.events?.onContentReady?.(),e.removeEventListener("load",t)};e.addEventListener("load",t)}#T(e,t,n){let r=document.createDocumentFragment();if((!this.config.waiting||this.config.mode==="system")&&r.appendChild(n),this.config.noLoader)e.style.height=this.config.height,e.style.width=this.config.width;else{let i=this.#c(this.config);r.appendChild(i)}return e.appendChild(r),t?.parentNode?(t.parentNode.insertBefore(e,t),t.remove()):t?.replaceWith(e),n}#E(){window.DocSpace.SDK.frames=window.DocSpace.SDK.frames||{},window.DocSpace.SDK.frames[this.config.frameId]=this}initFrame(e){this.config=this.#C(e);let t=this.#y(this.config.frameId);if(!t)return null;let{container:n,target:r}=t,i=this.#w();return this.#b(i),this.#T(n,r,i),this.#E(),i}destroyFrame(){let e=this.config.frameId,t=document.getElementById(`${e}-container`),n=document.createElement("div");if(n.id=e,n.className=this.#i,n.innerHTML=this.config.destroyText||"",t&&(t.parentNode?t.parentNode.replaceChild(n,t):document.body.appendChild(n),o._iframeCache)){let i=`${this.config.mode}_${this.config.id||""}_${this.config.frameId}`;o._iframeCache.pathCache.delete(i)}window.removeEventListener("message",this.#a),this.#n=!1,this.#t=[],this.#o=[];let r=window.DocSpace?.SDK?.frames;r&&e in r&&delete r[e]}#e=(e,t=null)=>new Promise(n=>{this.#p(e,t,r=>n(r))});setConfig(e=h){return this.config={...this.config,...e},this.#e("setConfig",this.config)}getConfig(){return this.config}getFolderInfo(){return this.#e("getFolderInfo")}getSelection(){return this.#e("getSelection")}getFiles(){return this.#e("getFiles")}getFolders(){return this.#e("getFolders")}getList(){return this.#e("getList")}getRooms(e){return this.#e("getRooms",e)}getUserInfo(){return this.#e("getUserInfo")}getHashSettings(){return this.#e("getHashSettings")}openModal(e,t){return this.#e("openModal",{type:e,options:t})}createFile(e,t,n,r){return this.#e("createFile",{folderId:e,title:t,templateId:n,formId:r})}createFolder(e,t){return this.#e("createFolder",{parentFolderId:e,title:t})}createRoom(e,t,n,r,i,a,s,l){return this.#e("createRoom",{title:e,roomType:t,...n!==void 0&&{quota:n},...l!==void 0&&{denyDownload:l},...r!==void 0&&{tags:r},...i!==void 0&&{color:i},...a!==void 0&&{cover:a},...s!==void 0&&{indexing:s}})}setListView(e){return this.#e("setListView",{viewType:e})}createHash(e,t){return this.#e("createHash",{password:e,hashSettings:t})}login(e,t,n,r){return this.#e("login",{email:e,passwordHash:t,...n!==void 0&&{password:n},...r!==void 0&&{session:r}})}logout(){return this.#e("logout")}createTag(e){return this.#e("createTag",{name:e})}addTagsToRoom(e,t){return this.#e("addTagsToRoom",{roomId:e,tags:t})}removeTagsFromRoom(e,t){return this.#e("removeTagsFromRoom",{roomId:e,tags:t})}createConnector(){return this.#e("createConnector")}removeConnector(){return this.#e("removeConnector")}callCommand(e,t,n){return this.#e("callCommand",{command:e,callback:t,recalcualte:n})}executeMethod(e,t,n){return this.#e("executeMethod",{name:e,args:t,callback:n})}};var y=class{frames={};init=e=>{let{frameId:t}=e,n=this.frames[t];if(n)return n.initFrame(e),n;let r=new C(e);return r.initFrame(e),this.frames[t]=r,r};initFrame=e=>this.init(e);initManager=e=>this.init({...e,mode:"manager"});initViewer=e=>this.init({...e,mode:"viewer"});initEditor=e=>this.init({...e,mode:"editor"});initRoomSelector=e=>this.init({...e,mode:"room-selector"});initFileSelector=e=>this.init({...e,mode:"file-selector"});initSystem=e=>this.init({...e,mode:"system"})};window.DocSpace=window.DocSpace||{};var j=k();window.DocSpace.SDK=window.DocSpace.SDK||new y;j?.init&&window.DocSpace.SDK.init(j);})();
/**
 * (c) Copyright Ascensio System SIA 2024
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @license
 */
