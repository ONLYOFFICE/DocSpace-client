## Technical Specification for i18n Translation Management Web Service

**Project Goal:** To develop a web service that enables users to manage i18n localization files (key-value pairs, nested JSON) according to a defined file structure, and to utilize locally running language models via Ollama for automated translation of text strings.

**Target Audience:** Software developers, localization managers, translators.

**1. Core Functional Requirements:**

**1.1. Project Management:**
* Create, edit, and delete projects.
* Each project represents a collection of localization files for a single application or component.

**1.2. Namespace / File Management:**
* Within a project, the ability to create and manage namespaces (logical grouping of keys, often corresponding to a translation file, e.g., `common.json`, `userProfile.json`).

**1.3. Translation Key Management:**
* Within a namespace: add, edit, and delete translation keys (supporting nested keys, e.g., `greetings.welcomeMessage`).
* Display the key structure as a tree or list.

**1.4. Translation Management:**
* Display a table/matrix: rows represent translation keys, columns represent project languages.
* Ability to manually add and edit translations for each key and language.
* Display the translation status (e.g., not translated, manually translated, AI translated).

**1.5. Ollama Integration:**
* Configure connection settings to a local Ollama server (specify API URL, typically `http://localhost:11434`).
* Ability to select an available Ollama model for translation (retrieve the list of models via the Ollama API).
* Automatic Translation Functionality:
    * Translate a specific value for a selected language.
    * Batch translate all untranslated keys within a namespace for a selected language.
    * Batch translate all untranslated keys within the entire project for a selected language.
    * Display the translation process (loading indication).
    * Store information indicating that a translation was generated by AI.

**1.6. Language Management:**
* Add and delete languages for a project (e.g., `en`, `es`, `fr`, `de`, `ru`).
* Specify the base language for the project (the language from which translations will be generated).

**1.7. User Interface (UI):**
* Intuitive interface for navigating projects, namespaces, keys, and translations.
* Visual highlighting of untranslated strings.
* Display the connection status to Ollama.
* Progress indicators for long-running operations (import, export, batch translation).

**2. Technology Stack:**

**2.1. Frontend:**
* Framework: Next.js (App Router)
* State Management: Zustand
* Styling: Tailwind CSS
* Backend Communication: Fetch API / Axios, Socket.IO Client

**2.2. Backend:**
* Platform: Node.js
* API Framework: Fastify
* Real-time Communication: Socket.IO
* Ollama Interaction: HTTP requests to the Ollama API.
* Database (Proposed): PostgreSQL (for structured data) or MongoDB (for flexible schema). **A specific database must be chosen and stated.**
* ORM/ODM (Optional): Prisma, Sequelize (for SQL) or Mongoose (for MongoDB).

**3. Architecture:**

**3.1. Client-Server Architecture:**
* Frontend (Next.js) interacts with the Backend API (Node.js) via RESTful endpoints and WebSocket (Socket.IO).

**3.2. Backend:**
* Provides an API for CRUD operations on data (projects, namespaces, keys, translations).
* Handles translation requests by interacting with the Ollama API.
* Uses Socket.IO to send notifications to the Frontend about the status of long-running operations (e.g., translation progress).

**3.3. Ollama Integration:**
* Backend sends HTTP POST requests to the `/api/generate` endpoint (or similar) of the Ollama API, providing the text to be translated and the necessary prompt (e.g., "Translate the following text from [SourceLang] to [TargetLang]: [TextToTranslate]").
* Handles responses and errors from Ollama.

**4. Data Model:**
Existing file structure, without database usage:

```json
{
  "Common": "public/locales",
  "Client": "packages/client/public/locales",
  "DocEditor": "packages/doceditor/public/locales",
  "Login": "packages/login/public/locales",
  "Management": "packages/management/public/locales"
}