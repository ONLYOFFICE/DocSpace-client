"use strict";(()=>{var S="/api/2.0/security/csp",T="frameDocSpace",h={src:"",rootPath:"/rooms/shared/",requestToken:null,width:"100%",height:"100%",name:T,type:"desktop",frameId:"ds-frame",mode:"manager",id:null,locale:null,theme:"System",editorType:"desktop",editorGoBack:!0,selectorType:"all",showSelectorCancel:!1,showSelectorHeader:!1,showHeader:!0,showHeaderBanner:"none",showTitle:!0,showMenu:!1,showFilter:!1,showSignOut:!0,destroyText:"",viewAs:"row",viewTableColumns:"Index,Name,Size,Type,Tags",checkCSP:!0,disableActionButton:!1,showSettings:!1,waiting:!1,noLoader:!0,withSearch:!0,withBreadCrumbs:!0,withSubtitle:!0,filterParam:"ALL",buttonColor:"#5299E0",infoPanelVisible:!0,downloadToEvent:!1,filter:{count:"100",page:"1",sortOrder:"descending",sortBy:"DateAndTime",search:"",withSubfolders:!1},editorCustomization:{},events:{onSelectCallback:null,onCloseCallback:null,onAppReady:null,onAppError:null,onEditorCloseCallback:null,onAuthSuccess:null,onSignOut:null,onDownload:null,onNoAccess:null,onNotFound:null,onContentReady:null,onEditorOpen:null}},b="The current domain is not set in the Content Security Policy (CSP) settings.",x="Message bus is not connected with frame";var f=r=>r?(Object.keys(r).forEach(e=>(r[e]===void 0||r[e]===null)&&delete r[e]),new URLSearchParams(r).toString()):"",L=async r=>{let{origin:e,host:t}=window.location;if(e.includes(r))return;let n=await fetch(`${r}${S}`,{method:"get",headers:new Headers({"ngrok-skip-browser-warning":"69420"})}),o;try{o=await n.json()}catch(l){throw new Error(`CSP validation failed: ${l}`)}let{response:{domains:s}}=o,a=t||new URL(e).host;if(!s.map(l=>{try{let c=new URL(l.toLowerCase());return c.host+(c.pathname!=="/"?c.pathname:"")}catch{return l}}).includes(a.toLowerCase()))throw new Error(b)},P=r=>`<body style=background:#f3f4f4><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300"rel=stylesheet><div style="display:flex;flex-direction:column;gap:80px;align-items:center;justify-content:flex-start;margin-top:60px;padding:0 30px"><div style=flex-shrink:0;width:211px;height:24px;position:relative><img src=${r}/static/images/logo/lightsmall.svg></div><div style=display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:flex-start;flex-shrink:0;position:relative><div style=flex-shrink:0;width:120px;height:100px;position:relative><img src=${r}/static/images/frame-error.svg></div><span style="color:#a3a9ae;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px">${b} Please add it via <a href=${r}/portal-settings/developer-tools/javascript-sdk style="color:#4781d1;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px;text-decoration-line:underline"target=_blank>the Developer Tools section</a>.</span></div></div></body>`,R=r=>`@keyframes rotate { 0%{ transform: rotate(-45deg); will-change: transform; } 15%{ transform: rotate(45deg); } 30%{ transform: rotate(135deg); } 45%{ transform: rotate(225deg); } 60%, 100%{ transform: rotate(315deg); } } .${r} { width: 74px; height: 74px; border: 4px solid rgba(51,51,51, 0.1); border-top-color: #333333; border-radius: 50%; transform: rotate(-45deg); position: relative; box-sizing: border-box; animation: 1s linear infinite rotate; will-change: transform; } @media (prefers-color-scheme: dark) { .${r} { border-color: rgba(204, 204, 204, 0.1); border-top-color: #CCCCCC; } } @media (prefers-reduced-motion: reduce) { .${r} { animation-duration: 1.5s; } }`,k=()=>{let r=document.currentScript,e=new URL(decodeURIComponent(r.src)).searchParams,t={...h};return e.forEach((n,o)=>{let s=n==="true"?!0:n==="false"?!1:n;h.filter&&o in h.filter?t.filter[o]=s:t[o]=s}),t.mode=e.get("mode")||"manager",t.src=e.get("src")||"",t},$=r=>{let e={theme:r.theme,locale:r.locale},t={acceptLabel:r.acceptButtonLabel,cancel:r.showSelectorCancel,cancelLabel:r.cancelButtonLabel,header:r.showSelectorHeader,roomType:r.roomType,search:r.withSearch},n={fileId:!r.id||r.id==="undefined"||r.id==="null"?-1:r.id,editorType:r.editorType,share:r.requestToken?r.requestToken:void 0,is_file:r.requestToken?!0:void 0,editorGoBack:r.events?.onEditorCloseCallback&&typeof r.events.onEditorCloseCallback=="function"?"event":r.editorGoBack?r.editorGoBack:void 0};switch(r.mode){case"manager":{r.id&&(r.filter.folder=r.id);let o=r.requestToken?{key:r.requestToken,...r.filter}:r.filter;o?.withSubfolders||delete o?.withSubfolders;let s=f(o);return`${r.rootPath}${r.requestToken?`?${s}`:`${r.id?r.id+"/":""}filter?${s}`}`}case"room-selector":{let o={...e,...t},s=f(o);return`/sdk/room-selector${s?`?${s}`:""}`}case"file-selector":{let o={...e,...t,breadCrumbs:r.withBreadCrumbs,filter:r.filterParam,id:r.id,selectorType:r.selectorType,subtitle:r.withSubtitle},s=f(o);return`/sdk/file-selector${s?`?${s}`:""}`}case"public-room":{let o={...e,folder:r.id,key:r.requestToken,showFilter:r.showFilter,showHeader:r.showHeader,showTitle:r.showTitle},s=f(o);return`/sdk/public-room${s?`?${s}`:""}`}case"system":{let o=f(e);return`/old-sdk/system${o?`?${o}`:""}`}case"editor":{let o={...e,...n},s=f(o);return`/doceditor${s?`?${s}`:""}`}case"viewer":{let o={...e,...n,action:"view"},s=f(o);return`/doceditor${s?`?${s}`:""}`}default:return r.rootPath||"/"}};var C=class r{#n=!1;#t=[];#r=[];#s="";config;constructor(e){this.config=e}static _loaderCache={style:new Map,container:document.createElement("div"),templates:new Map};static _iframeCache;#c=e=>{let{frameId:t,width:n,height:o}=e,s=`${t}-loader__element`,a=`${n}_${o}`,i=r._loaderCache.style,l=r._loaderCache.templates;if(!i.has(s)){let m=document.createElement("style");m.textContent=R(s);let g=document.createDocumentFragment();g.appendChild(m),document.head.appendChild(g),i.set(s,m)}let c;if(l.has(a))c=l.get(a).cloneNode(!0),c.id=`${t}-loader`;else{c=r._loaderCache.container.cloneNode(),Object.assign(c.style,{width:n,height:o,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"1",backgroundColor:"transparent",transition:"opacity 0.15s ease-out"});let m=document.createElement("div");m.className=s,c.appendChild(m),l.set(a,c.cloneNode(!0)),c.id=`${t}-loader`}return c};#m=e=>{if(!r._iframeCache){let w=document.createElement("iframe");w.allowFullscreen=!0,w.setAttribute("allow","storage-access *"),r._iframeCache={template:w,pathCache:new Map,styleCache:new Map}}let{mode:t,id:n,frameId:o,type:s,width:a,height:i,src:l,events:c,checkCSP:m}=e,g=s==="mobile",d=r._iframeCache.template.cloneNode(),E=`${t}_${n||""}_${o}`,F=`${a}_${i}_${g?"mobile":"desktop"}`,u=r._iframeCache.pathCache.get(E);u||(u=$(e),r._iframeCache.pathCache.set(E,u)),d.id=o,d.name=`${T}__#${o}`,d.src=l+u;let p=r._iframeCache.styleCache.get(F);return p||(p={width:a,height:i,border:"0px",opacity:"0",...g&&{position:"fixed",overflow:"hidden",webkitOverflowScrolling:"touch"}},r._iframeCache.styleCache.set(F,p)),Object.assign(d.style,p),g&&(document.body.style.overscrollBehaviorY!=="contain"&&(document.body.style.overscrollBehaviorY="contain"),"loading"in HTMLIFrameElement.prototype&&(d.loading="eager")),m&&this.#d(d,l,c),d};#d(e,t,n){requestAnimationFrame(()=>{L(t).catch(o=>{n?.onAppError?.(o.message),e.srcdoc=P(t),this.setIsLoaded()})})}setIsLoaded(){let{frameId:e,width:t,height:n,events:o}=this.config,s=document.getElementById(e),a=s?.parentElement;!s||!a||requestAnimationFrame(()=>{try{a.style.width=t,a.style.height=n;let i=document.getElementById(`${e}-loader`);i?(i.style.opacity="0",requestAnimationFrame(()=>{try{i.parentNode&&i.parentNode.removeChild(i),o?.onContentReady?.()}catch(l){console.error("Error removing loader:",l),o?.onContentReady?.()}})):o?.onContentReady?.(),requestAnimationFrame(()=>{Object.assign(s.style,{opacity:"1",position:"relative",width:t,height:n})})}catch(i){console.error("Error in setIsLoaded:",i),o?.onContentReady?.()}})}#i=e=>{try{let{frameId:t,src:n}=this.config,o=document.getElementById(t);if(!o?.contentWindow)return;let s={frameId:t,type:"",data:e};o.contentWindow.postMessage(JSON.stringify(s,(a,i)=>typeof i=="function"?i.toString():i),n)}catch(t){this.#o(t)}};#a=e=>{try{if(typeof e.data!="string")return;let t=this.#h(e.data);if(t.frameId!==this.config.frameId)return;switch(t.type){case"onMethodReturn":this.#f(t);break;case"onEventReturn":t.eventReturnData&&this.#g(t.eventReturnData);break;case"onCallCommand":this.#u(t);break;case"error":t.error&&this.#o(t.error);break;default:console.warn("Unrecognized message type:",t.type)}}catch(t){this.#o(t)}};#h(e){try{let t=JSON.parse(e);if(!t||typeof t!="object")throw new Error("Invalid message structure");return t.frameId||(t.frameId=""),t}catch(t){let n=t instanceof Error?t.message:"Unknown parsing error";return console.warn("Failed to parse message:",n),{frameId:"error",type:"error",commandName:"parseMessageData",error:{message:"Invalid message format: "+n}}}}#f(e){let t=this.#t.shift();if(t)try{t(e.methodReturnData||{})}catch(n){console.error("Error in callback execution:",n)}this.#r.length>0&&this.#i(this.#r.shift())}#g(e){if(!e?.event)return;let t=e.event,n=this.config.events?.[t];if(typeof n=="function")try{n(e.data||{})}catch(o){console.error(`Event handler '${t}' failed:`,o)}}#u(e){if(!e.commandName)return;let t=this[e.commandName];typeof t=="function"&&t.call(this,e.commandData)}#o(e){console.error("SDK Error:",e),this.config.events?.onAppError?.(e instanceof Error?e.message:"Unown error occurred")}#p(e,t,n){if(!this.#n&&e!=="setConfig"){this.#o({message:x});return}this.#t.push(n);let o={type:"method",methodName:e,data:t};this.#t.length>1?this.#r.push(o):this.#i(o)}#C(e){let t={...this.config,...h,...e};return(t.mode==="manager"||t.mode==="system")&&(t.noLoader=!1),t}#y(e){let t=document.getElementById(e);if(!t)return null;let n=document.getElementById(`${e}-container`);if(n){let o=n.parentNode;if(o){let s=document.createElement("div");s.id=e,o.replaceChild(s,n);let a=`${this.config.mode}_${this.config.id||""}_${this.config.frameId}`;return r._iframeCache.pathCache.delete(a),this.#l(s)}}return this.#s=t.className,this.#l(t)}#l(e){let t=document.createElement("div");return t.id=e.id+"-container",t.className="frame-container",Object.assign(t.style,{position:"relative",width:this.config.width,height:this.config.height}),{container:t,target:e}}#w(){let e=this.#m(this.config);return Object.assign(e.style,{opacity:this.config.noLoader?"1":"0",zIndex:"2",position:this.config.noLoader?"relative":"absolute",width:this.config.noLoader?this.config.width:"100%",height:this.config.noLoader?this.config.height:"100%",top:"0",left:"0"}),e}#T(e){let t=()=>{window.addEventListener("message",this.#a,!1),this.#n=!0,this.config.noLoader&&this.config.events?.onContentReady?.(),e.removeEventListener("load",t)};e.addEventListener("load",t)}#b(e,t,n){let o=document.createDocumentFragment();if((!this.config.waiting||this.config.mode==="system")&&o.appendChild(n),this.config.noLoader)e.style.height=this.config.height,e.style.width=this.config.width;else{let s=this.#c(this.config);o.appendChild(s)}return e.appendChild(o),t?.parentNode?(t.parentNode.insertBefore(e,t),t.remove()):t?.replaceWith(e),n}#E(){window.DocSpace.SDK.frames=window.DocSpace.SDK.frames||{},window.DocSpace.SDK.frames[this.config.frameId]=this}initFrame(e){this.config=this.#C(e);let t=this.#y(this.config.frameId);if(!t)return null;let{container:n,target:o}=t,s=this.#w();return this.#T(s),this.#b(n,o,s),this.#E(),s}destroyFrame(){let e=this.config.frameId,t=document.getElementById(`${e}-container`),n=document.createElement("div");if(n.id=e,n.className=this.#s,n.innerHTML=this.config.destroyText||"",t&&(t.parentNode?t.parentNode.replaceChild(n,t):document.body.appendChild(n),r._iframeCache)){let s=`${this.config.mode}_${this.config.id||""}_${this.config.frameId}`;r._iframeCache.pathCache.delete(s)}window.removeEventListener("message",this.#a),this.#n=!1,this.#t=[],this.#r=[];let o=window.DocSpace?.SDK?.frames;o&&e in o&&delete o[e]}#e=(e,t=null)=>new Promise(n=>{this.#p(e,t,o=>n(o))});setConfig(e=h){return this.config={...this.config,...e},this.#e("setConfig",this.config)}getConfig(){return this.config}getFolderInfo(){return this.#e("getFolderInfo")}getSelection(){return this.#e("getSelection")}getFiles(){return this.#e("getFiles")}getFolders(){return this.#e("getFolders")}getList(){return this.#e("getList")}getRooms(e){return this.#e("getRooms",e)}getUserInfo(){return this.#e("getUserInfo")}getHashSettings(){return this.#e("getHashSettings")}openModal(e,t){return this.#e("openModal",{type:e,options:t})}createFile(e,t,n,o){return this.#e("createFile",{folderId:e,title:t,templateId:n,formId:o})}createFolder(e,t){return this.#e("createFolder",{parentFolderId:e,title:t})}createRoom(e,t,n,o,s,a,i,l){return this.#e("createRoom",{title:e,roomType:t,...n!==void 0&&{quota:n},...l!==void 0&&{denyDownload:l},...o!==void 0&&{tags:o},...s!==void 0&&{color:s},...a!==void 0&&{cover:a},...i!==void 0&&{indexing:i}})}setListView(e){return this.#e("setListView",{viewType:e})}createHash(e,t){return this.#e("createHash",{password:e,hashSettings:t})}login(e,t,n,o){return this.#e("login",{email:e,passwordHash:t,...n!==void 0&&{password:n},...o!==void 0&&{session:o}})}logout(){return this.#e("logout")}createTag(e){return this.#e("createTag",{name:e})}addTagsToRoom(e,t){return this.#e("addTagsToRoom",{roomId:e,tags:t})}removeTagsFromRoom(e,t){return this.#e("removeTagsFromRoom",{roomId:e,tags:t})}executeInEditor(e,t){this.#e("executeInEditor",{callback:e,data:t})}};var y=class{frames={};init=e=>{let{frameId:t}=e,n=this.frames[t];if(n)return n.initFrame(e),n;let o=new C(e);return o.initFrame(e),this.frames[t]=o,o};initFrame=e=>this.init(e);initManager=e=>this.init({...e,mode:"manager"});initViewer=e=>this.init({...e,mode:"viewer"});initEditor=e=>this.init({...e,mode:"editor"});initRoomSelector=e=>this.init({...e,mode:"room-selector"});initFileSelector=e=>this.init({...e,mode:"file-selector"});initSystem=e=>this.init({...e,mode:"system"})};window.DocSpace=window.DocSpace||{};var D=k();window.DocSpace.SDK=window.DocSpace.SDK||new y;D?.init&&window.DocSpace.SDK.init(D);})();
/**
 * (c) Copyright Ascensio System SIA 2024
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @license
 */
