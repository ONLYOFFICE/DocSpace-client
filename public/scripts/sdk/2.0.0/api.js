"use strict";(()=>{var C="/api/2.0/security/csp",u="frameDocSpace",m={src:"",rootPath:"/rooms/shared/",requestToken:null,width:"100%",height:"100%",name:u,type:"desktop",frameId:"ds-frame",mode:"manager",id:null,locale:null,theme:"System",editorType:"desktop",editorGoBack:!0,selectorType:"all",showSelectorCancel:!1,showSelectorHeader:!1,showHeader:!1,showHeaderBanner:"none",showTitle:!0,showMenu:!1,showFilter:!1,showSignOut:!0,destroyText:"",viewAs:"row",viewTableColumns:"Index,Name,Size,Type,Tags",checkCSP:!0,disableActionButton:!1,showSettings:!1,waiting:!1,noLoader:!0,withSearch:!0,withBreadCrumbs:!0,withSubtitle:!0,filterParam:"ALL",buttonColor:"#5299E0",infoPanelVisible:!0,downloadToEvent:!1,filter:{count:"100",page:"1",sortOrder:"descending",sortBy:"DateAndTime",search:"",withSubfolders:!1},editorCustomization:{},events:{onSelectCallback:null,onCloseCallback:null,onAppReady:null,onAppError:null,onEditorCloseCallback:null,onAuthSuccess:null,onSignOut:null,onDownload:null,onNoAccess:null,onNotFound:null,onContentReady:null,onEditorOpen:null}},g="The current domain is not set in the Content Security Policy (CSP) settings.",w="Message bus is not connected with frame";var c=r=>r?(Object.keys(r).forEach(e=>(r[e]===void 0||r[e]===null)&&delete r[e]),new URLSearchParams(r).toString()):"",b=async r=>{let{origin:e,host:t}=window.location;if(e.includes(r))return;let n=await fetch(`${r}${C}`,{method:"get",headers:new Headers({"ngrok-skip-browser-warning":"69420"})}),o;try{o=await n.json()}catch(i){throw new Error(`CSP validation failed: ${i}`)}let{response:{domains:s}}=o,a=t||new URL(e).host;if(!s.map(i=>{try{let d=new URL(i.toLowerCase());return d.host+(d.pathname!=="/"?d.pathname:"")}catch{return i}}).includes(a.toLowerCase()))throw new Error(g)},T=r=>`<body style=background:#f3f4f4><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300"rel=stylesheet><div style="display:flex;flex-direction:column;gap:80px;align-items:center;justify-content:flex-start;margin-top:60px;padding:0 30px"><div style=flex-shrink:0;width:211px;height:24px;position:relative><img src=${r}/static/images/logo/lightsmall.svg></div><div style=display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:flex-start;flex-shrink:0;position:relative><div style=flex-shrink:0;width:120px;height:100px;position:relative><img src=${r}/static/images/frame-error.svg></div><span style="color:#a3a9ae;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px">${g} Please add it via <a href=${r}/portal-settings/developer-tools/javascript-sdk style="color:#4781d1;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px;text-decoration-line:underline"target=_blank>the Developer Tools section</a>.</span></div></div></body>`,y=r=>`@keyframes rotate { 0%{ transform: rotate(-45deg); will-change: transform; } 15%{ transform: rotate(45deg); } 30%{ transform: rotate(135deg); } 45%{ transform: rotate(225deg); } 60%, 100%{ transform: rotate(315deg); } } .${r} { width: 74px; height: 74px; border: 4px solid rgba(51,51,51, 0.1); border-top-color: #333333; border-radius: 50%; transform: rotate(-45deg); position: relative; box-sizing: border-box; animation: 1s linear infinite rotate; will-change: transform; } @media (prefers-color-scheme: dark) { .${r} { border-color: rgba(204, 204, 204, 0.1); border-top-color: #CCCCCC; } } @media (prefers-reduced-motion: reduce) { .${r} { animation-duration: 1.5s; } }`,F=()=>{let r=document.currentScript,e=new URL(decodeURIComponent(r.src)).searchParams,t={...m};return e.forEach((n,o)=>{let s=n==="true"?!0:n==="false"?!1:n;m.filter&&o in m.filter?t.filter[o]=s:t[o]=s}),t.mode=e.get("mode")||"manager",t.src=e.get("src")||"",t},E=r=>{let e={theme:r.theme,locale:r.locale},t={acceptLabel:r.acceptButtonLabel,cancel:r.showSelectorCancel,cancelLabel:r.cancelButtonLabel,header:r.showSelectorHeader,roomType:r.roomType,search:r.withSearch},n={fileId:!r.id||r.id==="undefined"||r.id==="null"?-1:r.id,editorType:r.editorType,share:r.requestToken?r.requestToken:void 0,is_file:r.requestToken?!0:void 0,editorGoBack:r.events?.onEditorCloseCallback&&typeof r.events.onEditorCloseCallback=="function"?"event":r.editorGoBack?r.editorGoBack:void 0};switch(r.mode){case"manager":{r.id&&(r.filter.folder=r.id);let o=r.requestToken?{key:r.requestToken,...r.filter}:r.filter;o?.withSubfolders||delete o?.withSubfolders;let s=c(o);return`${r.rootPath}${r.requestToken?`?${s}`:`${r.id?r.id+"/":""}filter?${s}`}`}case"room-selector":{let o={...e,...t},s=c(o);return`/sdk/room-selector${s?`?${s}`:""}`}case"file-selector":{let o={...e,...t,breadCrumbs:r.withBreadCrumbs,filter:r.filterParam,id:r.id,selectorType:r.selectorType,subtitle:r.withSubtitle},s=c(o);return`/sdk/file-selector${s?`?${s}`:""}`}case"public-room":{let o={...e,folder:r.id,key:r.requestToken,showFilter:r.showFilter,showHeader:r.showHeader,showTitle:r.showTitle},s=c(o);return`/sdk/public-room${s?`?${s}`:""}`}case"system":{let o=c(e);return`/old-sdk/system${o?`?${o}`:""}`}case"editor":{let o={...e,...n},s=c(o);return`/doceditor${s?`?${s}`:""}`}case"viewer":{let o={...e,...n,action:"view"},s=c(o);return`/doceditor${s?`?${s}`:""}`}default:return r.rootPath||"/"}};var h=class r{#o=!1;#t=[];#r=[];#n="";config;constructor(e){this.config=e}static _loaderCache={style:new Map,container:document.createElement("div"),templates:new Map};static _iframeCache;#m=e=>{let{frameId:t,width:n,height:o}=e,s=`${t}-loader__element`,a=`${n}_${o}`;if(!r._loaderCache.style.has(s)){let i=document.createElement("style");i.textContent=y(s);let d=document.createDocumentFragment();d.appendChild(i),document.head.appendChild(d),r._loaderCache.style.set(s,i)}let l;if(r._loaderCache.templates.has(a))l=r._loaderCache.templates.get(a).cloneNode(!0),l.id=`${t}-loader`;else{l=r._loaderCache.container.cloneNode(),Object.assign(l.style,{width:n,height:o,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"1",backgroundColor:"transparent",transition:"opacity 0.15s ease-out"});let i=document.createElement("div");i.className=s,l.appendChild(i),r._loaderCache.templates.set(a,l.cloneNode(!0)),l.id=`${t}-loader`}return l};#c=e=>{r._iframeCache||(r._iframeCache={template:document.createElement("iframe"),pathCache:new Map},r._iframeCache.template.allowFullscreen=!0,r._iframeCache.template.setAttribute("allow","storage-access *"));let t=r._iframeCache.template.cloneNode(),n=`${e.mode}_${e.id||""}_${e.frameId}`,o=r._iframeCache.pathCache.get(n);return o||(o=E(e),r._iframeCache.pathCache.set(n,o)),t.id=e.frameId,t.name=`${u}__#${e.frameId}`,t.src=e.src+o,Object.assign(t.style,{width:e.width,height:e.height,border:"0px",opacity:"0",...e.type==="mobile"&&{position:"fixed",overflow:"hidden",webkitOverflowScrolling:"touch"}}),e.type==="mobile"&&(document.body.style.overscrollBehaviorY="contain","loading"in HTMLIFrameElement.prototype&&(t.loading="eager")),e.checkCSP&&requestAnimationFrame(()=>{b(e.src).catch(s=>{e.events?.onAppError&&e.events.onAppError(s.message),t.srcdoc=T(e.src),this.setIsLoaded()})}),t};setIsLoaded(){let e=this.config.frameId,t=document.getElementById(e),n=t?.parentElement;!t||!n||requestAnimationFrame(()=>{n.style.height=this.config.height,n.style.width=this.config.width;let o=document.getElementById(`${e}-loader`);if(o){o.style.opacity="0";let s=()=>{o.parentNode&&o.parentNode.removeChild(o),this.config.events?.onContentReady?.()};requestAnimationFrame(()=>{s()})}else this.config.events?.onContentReady?.();requestAnimationFrame(()=>{Object.assign(t.style,{opacity:"1",position:"relative",width:this.config.width,height:this.config.height})})})}#s=e=>{let t=document.getElementById(this.config.frameId);t?.contentWindow&&t.contentWindow.postMessage(JSON.stringify({frameId:this.config.frameId,type:"",data:e},(n,o)=>typeof o=="function"?o.toString():o),this.config.src)};#i=e=>{if(typeof e.data!="string")return;let t=this.#d(e.data);if(t.frameId===this.config.frameId)switch(t.type){case"onMethodReturn":this.#h(t);break;case"onEventReturn":t.eventReturnData&&this.#f(t.eventReturnData);break;case"onCallCommand":this.#u(t);break;case"error":t.error&&this.#a(t.error);break}};#d(e){try{return JSON.parse(e)}catch(t){return console.warn("Failed to parse message:",t),{frameId:"error",type:"error",commandName:"parseMessageData",error:{message:"Invalid message format"}}}}#h(e){this.#t.shift()?.(e.methodReturnData),this.#r.length>0&&this.#s(this.#r.shift())}#f(e){if(!e?.event)return;let t=e.event,n=this.config.events?.[t];if(typeof n=="function")try{n(e.data)}catch(o){console.error("Event handler failed:",t,o)}}#u(e){let t=this[e.commandName];typeof t=="function"&&t.call(this,e.commandData)}#a(e){console.error("SDK Error:",e),this.config.events?.onAppError?.(e.message)}#g(e,t,n){if(!this.#o&&e!=="setConfig"){this.#a({message:w});return}this.#t=[...this.#t,n];let o={type:"method",methodName:e,data:t};this.#t.length>1?this.#r=[...this.#r,o]:this.#s(o)}#p(e){let t={...this.config,...m,...e};return(t.mode==="manager"||t.mode==="system")&&(t.noLoader=!1),t}#l(e){let t=document.getElementById(e);if(!t)return null;let n=document.getElementById(`${e}-container`);if(n){let s=document.createElement("div");if(s.id=e,n.parentNode){n.parentNode.replaceChild(s,n);let a=`${this.config.mode}_${this.config.id||""}_${this.config.frameId}`;return console.log("Element already exist, clear cache and recreate:",a),r._iframeCache.pathCache.delete(a),this.#l(e)}}this.#n=t.className;let o=document.createElement("div");return Object.assign(o,{id:e+"-container",className:"frame-container",style:{position:"relative",width:this.config.width,height:this.config.height}}),{container:o,target:t}}#C(){let e=this.#c(this.config);return Object.assign(e.style,{opacity:this.config.noLoader?"1":"0",zIndex:"2",position:this.config.noLoader?"relative":"absolute",width:this.config.noLoader?this.config.width:"100%",height:this.config.noLoader?this.config.height:"100%",top:"0",left:"0"}),e}#w(e){let t=()=>{window.addEventListener("message",this.#i,!1),this.#o=!0,this.config.noLoader&&this.config.events?.onContentReady?.(),e.removeEventListener("load",t)};e.addEventListener("load",t)}#b(e,t,n){let o=document.createDocumentFragment();if((!this.config.waiting||this.config.mode==="system")&&o.appendChild(n),this.config.noLoader)e.style.height=this.config.height,e.style.width=this.config.width;else{let s=this.#m(this.config);o.appendChild(s)}return e.appendChild(o),t?.parentNode?(t.parentNode.insertBefore(e,t),t.remove()):t?.replaceWith(e),n}#T(){window.DocSpace.SDK.frames=window.DocSpace.SDK.frames||{},window.DocSpace.SDK.frames[this.config.frameId]=this}initFrame(e){this.config=this.#p(e);let t=this.#l(this.config.frameId);if(!t)return null;let{container:n,target:o}=t,s=this.#C();return this.#w(s),this.#b(n,o,s),this.#T(),s}destroyFrame(){let e=this.config.frameId,t=document.getElementById(`${e}-container`),n=window.DocSpace?.SDK?.frames,o=document.createElement("div");o.id=e,o.className=this.#n,o.innerHTML=this.config.destroyText||"",t&&(t.parentNode?(t.parentNode.insertBefore(o,t),t.parentNode.removeChild(t)):document.body.appendChild(o)),window.removeEventListener("message",this.#i),this.#o=!1,this.#t=[],this.#r=[],n&&delete n[e]}#e=(e,t=null)=>new Promise(n=>{this.#g(e,t,o=>n(o))});setConfig(e=m){return this.config={...this.config,...e},this.#e("setConfig",this.config)}getConfig(){return this.config}getFolderInfo(){return this.#e("getFolderInfo")}getSelection(){return this.#e("getSelection")}getFiles(){return this.#e("getFiles")}getFolders(){return this.#e("getFolders")}getList(){return this.#e("getList")}getRooms(e){return this.#e("getRooms",e)}getUserInfo(){return this.#e("getUserInfo")}getHashSettings(){return this.#e("getHashSettings")}openModal(e,t){return this.#e("openModal",{type:e,options:t})}createFile(e,t,n,o){return this.#e("createFile",{folderId:e,title:t,templateId:n,formId:o})}createFolder(e,t){return this.#e("createFolder",{parentFolderId:e,title:t})}createRoom(e,t,n,o,s,a,l,i){return this.#e("createRoom",{title:e,roomType:t,...n!==void 0&&{quota:n},...i!==void 0&&{denyDownload:i},...o!==void 0&&{tags:o},...s!==void 0&&{color:s},...a!==void 0&&{cover:a},...l!==void 0&&{indexing:l}})}setListView(e){return this.#e("setListView",{viewType:e})}createHash(e,t){return this.#e("createHash",{password:e,hashSettings:t})}login(e,t,n,o){return this.#e("login",{email:e,passwordHash:t,...n!==void 0&&{password:n},...o!==void 0&&{session:o}})}logout(){return this.#e("logout")}createTag(e){return this.#e("createTag",{name:e})}addTagsToRoom(e,t){return this.#e("addTagsToRoom",{roomId:e,tags:t})}removeTagsFromRoom(e,t){return this.#e("removeTagsFromRoom",{roomId:e,tags:t})}getEditorInstance(){return this.#e("getEditorInstance")}};var f=class{frames={};init=e=>{let{frameId:t}=e,n=this.frames[t];if(n)return n.initFrame(e),n;let o=new h(e);return o.initFrame(e),this.frames[t]=o,o};initFrame=e=>this.init(e);initManager=e=>this.init({...e,mode:"manager"});initViewer=e=>this.init({...e,mode:"viewer"});initEditor=e=>this.init({...e,mode:"editor"});initRoomSelector=e=>this.init({...e,mode:"room-selector"});initFileSelector=e=>this.init({...e,mode:"file-selector"});initSystem=e=>this.init({...e,mode:"system"})};window.DocSpace=window.DocSpace||{};var v=F();window.DocSpace.SDK=window.DocSpace.SDK||new f;v?.init&&window.DocSpace.SDK.init(v);})();
/**
 * (c) Copyright Ascensio System SIA 2024
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @license
 */
