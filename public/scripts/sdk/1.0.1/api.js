"use strict";(()=>{var b="/api/2.0/security/csp",f="frameDocSpace",m={src:"",rootPath:"/rooms/shared/",requestToken:null,width:"100%",height:"100%",name:f,type:"desktop",frameId:"ds-frame",mode:"manager",id:null,locale:null,theme:"System",editorType:"desktop",editorGoBack:!0,selectorType:"all",showSelectorCancel:!1,showSelectorHeader:!1,showHeader:!1,showHeaderBanner:"none",showTitle:!0,showMenu:!1,showFilter:!1,showSignOut:!0,destroyText:"",viewAs:"row",viewTableColumns:"Index,Name,Size,Type,Tags",checkCSP:!0,disableActionButton:!1,showSettings:!1,waiting:!1,noLoader:!0,withSearch:!0,withBreadCrumbs:!0,withSubtitle:!0,filterParam:"ALL",buttonColor:"#5299E0",infoPanelVisible:!0,downloadToEvent:!1,filter:{count:"100",page:"1",sortOrder:"descending",sortBy:"DateAndTime",search:"",withSubfolders:!1},editorCustomization:{},events:{onSelectCallback:null,onCloseCallback:null,onAppReady:null,onAppError:null,onEditorCloseCallback:null,onAuthSuccess:null,onSignOut:null,onDownload:null,onNoAccess:null,onNotFound:null,onContentReady:null,onEditorOpen:null}},g="The current domain is not set in the Content Security Policy (CSP) settings.",C="Message bus is not connected with frame";var c=r=>r?(Object.keys(r).forEach(e=>(r[e]===void 0||r[e]===null)&&delete r[e]),new URLSearchParams(r).toString()):"",w=async r=>{let{origin:e,host:t}=window.location;if(e.includes(r))return;let o=await fetch(`${r}${b}`,{method:"get",headers:new Headers({"ngrok-skip-browser-warning":"69420"})}),n;try{n=await o.json()}catch(i){throw new Error(`CSP validation failed: ${i}`)}let{response:{domains:s}}=n,a=t||new URL(e).host;if(!s.map(i=>{try{let u=new URL(i.toLowerCase());return u.host+(u.pathname!=="/"?u.pathname:"")}catch{return i}}).includes(a.toLowerCase()))throw new Error(g)},y=r=>`<body style=background:#f3f4f4><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300"rel=stylesheet><div style="display:flex;flex-direction:column;gap:80px;align-items:center;justify-content:flex-start;margin-top:60px;padding:0 30px"><div style=flex-shrink:0;width:211px;height:24px;position:relative><img src=${r}/static/images/logo/lightsmall.svg></div><div style=display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:flex-start;flex-shrink:0;position:relative><div style=flex-shrink:0;width:120px;height:100px;position:relative><img src=${r}/static/images/frame-error.svg></div><span style="color:#a3a9ae;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px">${g} Please add it via <a href=${r}/portal-settings/developer-tools/javascript-sdk style="color:#4781d1;text-align:center;font-family:Open Sans;font-size:14px;font-style:normal;font-weight:700;line-height:16px;text-decoration-line:underline"target=_blank>the Developer Tools section</a>.</span></div></div></body>`,T=r=>`@keyframes rotate { 0%{ transform: rotate(-45deg); } 15%{ transform: rotate(45deg); } 30%{ transform: rotate(135deg); } 45%{ transform: rotate(225deg); } 60%, 100%{ transform: rotate(315deg); } } .${r} { width: 74px; height: 74px; border: 4px solid rgba(51,51,51, 0.1); border-top-color: #333333; border-radius: 50%; transform: rotate(-45deg); position: relative; box-sizing: border-box; animation: 1s linear infinite rotate; } @media (prefers-color-scheme: dark) { .${r} { border-color: rgba(204, 204, 204, 0.1); border-top-color: #CCCCCC; } }`,S=()=>{let r=document.currentScript,e=new URL(decodeURIComponent(r.src)).searchParams,t={...m};return e.forEach((o,n)=>{let s=o==="true"?!0:o==="false"?!1:o;m.filter&&n in m.filter?t.filter[n]=s:t[n]=s}),t.mode=e.get("mode")||"manager",t.src=e.get("src")||"",t},v=r=>{switch(r.mode){case"manager":{r.id&&(r.filter.folder=r.id);let e=r.requestToken?{key:r.requestToken,...r.filter}:r.filter;e?.withSubfolders||delete e?.withSubfolders;let t=c(e);return`${r.rootPath}${r.requestToken?`?${t}`:`${r.id?r.id+"/":""}filter?${t}`}`}case"room-selector":{let e={acceptLabel:r.acceptButtonLabel,cancel:r.showSelectorCancel,cancelLabel:r.cancelButtonLabel,header:r.showSelectorHeader,locale:r.locale,roomType:r.roomType,search:r.withSearch,theme:r.theme},t=c(e);return`/sdk/room-selector${t?`?${t}`:""}`}case"file-selector":{let e={acceptLabel:r.acceptButtonLabel,breadCrumbs:r.withBreadCrumbs,cancel:r.showSelectorCancel,cancelLabel:r.cancelButtonLabel,filter:r.filterParam,header:r.showSelectorHeader,id:r.id,locale:r.locale,roomType:r.roomType,search:r.withSearch,selectorType:r.selectorType,subtitle:r.withSubtitle,theme:r.theme},t=c(e);return`/sdk/file-selector${t?`?${t}`:""}`}case"public-room":{let e={theme:r.theme,locale:r.locale,folder:r.id,key:r.requestToken},t=c(e);return`/sdk/public-room${t?`?${t}`:""}`}case"system":return"/old-sdk/system";case"editor":{let e={locale:r.locale,theme:r.theme,fileId:!r.id||r.id==="undefined"||r.id==="null"?-1:r.id,editorType:r.editorType};r.events?.onEditorCloseCallback&&typeof r.events.onEditorCloseCallback=="function"&&(e.editorGoBack="event"),r.requestToken&&(e.share=r.requestToken,e.is_file=!0);let t=c(e);return`/doceditor${t?`?${t}`:""}`}case"viewer":{let e={locale:r.locale,theme:r.theme,fileId:!r.id||r.id==="undefined"||r.id==="null"?-1:r.id,editorType:r.editorType,action:"view"};r.events?.onEditorCloseCallback&&typeof r.events.onEditorCloseCallback=="function"&&(e.editorGoBack="event"),r.requestToken&&(e.share=r.requestToken,e.is_file=!0);let t=c(e);return`/doceditor${t?`?${t}`:""}`}default:return r.rootPath}};var d=class r{#o=!1;#l="0";#t=[];#r=[];#n="";config;constructor(e){this.config=e}static _loaderCache={style:new Map,container:document.createElement("div")};#m=e=>{let{frameId:t,width:o,height:n}=e,s=`${t}-loader__element`;if(!r._loaderCache.style.has(s)){let i=document.createElement("style");i.textContent=T(s),document.head.append(i),r._loaderCache.style.set(s,i)}let a=r._loaderCache.container.cloneNode();a.id=`${t}-loader`,Object.assign(a.style,{width:o,height:n,display:"flex",justifyContent:"center",alignItems:"center"});let l=document.createElement("div");return l.className=s,a.append(l),a};#c=e=>{let t=document.createElement("iframe"),o=v(e);return Object.assign(t,{id:e.frameId,src:e.src+o,name:`${f}__#${e.frameId}`,allowFullscreen:!0}),Object.assign(t.style,{width:e.width,height:e.height,border:"0px",...e.type==="mobile"&&{position:"fixed",overflow:"hidden"}}),t.setAttribute("allow","storage-access *"),e.type==="mobile"&&(document.body.style.overscrollBehaviorY="contain"),e.checkCSP&&requestAnimationFrame(()=>{w(e.src).catch(n=>{e.events?.onAppError?.(n.message),t.srcdoc=y(e.src),this.setIsLoaded()})}),t};#s=e=>{let t=document.getElementById(this.config.frameId);t?.contentWindow&&t.contentWindow.postMessage(JSON.stringify({frameId:this.config.frameId,type:"",data:e},(o,n)=>typeof n=="function"?n.toString():n),this.config.src)};#i=e=>{if(typeof e.data!="string")return;let t=this.#d(e.data);if(t.frameId===this.config.frameId)switch(t.type){case"onMethodReturn":this.#h(t);break;case"onEventReturn":t.eventReturnData&&this.#u(t.eventReturnData);break;case"onCallCommand":this.#f(t);break;case"error":t.error&&this.#a(t.error);break}};#d(e){try{return JSON.parse(e)}catch(t){return console.warn("Failed to parse message:",t),{frameId:"error",type:"error",commandName:"parseMessageData",error:{message:"Invalid message format"}}}}#h(e){this.#t.shift()?.(e.methodReturnData),this.#r.length>0&&this.#s(this.#r.shift())}#u(e){if(!e?.event)return;let t=e.event,o=this.config.events?.[t];if(typeof o=="function")try{o(e.data)}catch(n){console.error("Event handler failed:",t,n)}}#f(e){let t=this[e.commandName];typeof t=="function"&&t.call(this,e.commandData)}#a(e){console.error("SDK Error:",e),this.config.events?.onAppError?.(e.message)}#g(e,t,o){if(!this.#o){this.#a({message:C});return}this.#t=[...this.#t,o];let n={type:"method",methodName:e,data:t};this.#t.length>1?this.#r=[...this.#r,n]:this.#s(n)}setIsLoaded(){let e=this.config.frameId,t=document.getElementById(e),o=t?.parentElement;if(!t||!o)return;Object.assign(t.style,{opacity:"1",position:"relative",width:this.config.width,height:this.config.height}),o.style.height=this.config.height,document.getElementById(`${e}-loader`)?.remove(),this.config.events?.onContentReady?.()}initFrame(e){this.config={...this.config,...m,...e};let t=document.getElementById(this.config.frameId);if(!t)return null;(this.config.mode==="manager"||this.config.mode==="system")&&(this.config.noLoader=!1),this.#n=t.className;let o=document.createDocumentFragment(),n=document.createElement("div");Object.assign(n,{id:this.config.frameId+"-container",className:"frame-container"}),Object.assign(n.style,{position:"relative",width:this.config.width,height:this.config.height});let s=this.#c(this.config);if(Object.assign(s.style,{opacity:this.config.noLoader?"1":this.#l,zIndex:"2",position:this.config.noLoader?"relative":"absolute",width:"100%",height:"100%",top:"0",left:"0"}),(!this.config.waiting||this.config.mode==="system")&&o.appendChild(s),!this.config.noLoader){let l=this.#m(this.config);o.appendChild(l)}return n.appendChild(o),t.parentNode?.isEqualNode(document.getElementById(this.config.frameId+"-container"))?t.parentNode?.replaceWith(n):t.replaceWith(n),window.addEventListener("message",this.#i,!1),this.#o=!0,window.DocSpace.SDK.frames=window.DocSpace.SDK.frames||{},window.DocSpace.SDK.frames[this.config.frameId]=this,s}destroyFrame(){let e=this.config.frameId,t=document.getElementById(e),o=window.DocSpace?.SDK?.frames;t&&(t.innerHTML=this.config.destroyText||"",t.className=this.#n,t.replaceWith(t.cloneNode(!1))),window.removeEventListener("message",this.#i,!1),this.#o=!1,o&&delete o[e]}#e=(e,t=null)=>new Promise(o=>{this.#g(e,t,n=>o(n))});setConfig(e=m){return this.config={...this.config,...e},this.#e("setConfig",this.config)}getConfig(){return this.config}getFolderInfo(){return this.#e("getFolderInfo")}getSelection(){return this.#e("getSelection")}getFiles(){return this.#e("getFiles")}getFolders(){return this.#e("getFolders")}getList(){return this.#e("getList")}getRooms(e){return this.#e("getRooms",e)}getUserInfo(){return this.#e("getUserInfo")}getHashSettings(){return this.#e("getHashSettings")}openModal(e,t){return this.#e("openModal",{type:e,options:t})}createFile(e,t,o,n){return this.#e("createFile",{folderId:e,title:t,templateId:o,formId:n})}createFolder(e,t){return this.#e("createFolder",{parentFolderId:e,title:t})}createRoom(e,t,o,n,s,a,l,i){return this.#e("createRoom",{title:e,roomType:t,...o!==void 0&&{quota:o},...i!==void 0&&{denyDownload:i},...n!==void 0&&{tags:n},...s!==void 0&&{color:s},...a!==void 0&&{cover:a},...l!==void 0&&{indexing:l}})}setListView(e){return this.#e("setListView",{viewType:e})}createHash(e,t){return this.#e("createHash",{password:e,hashSettings:t})}login(e,t,o,n){return this.#e("login",{email:e,passwordHash:t,...o!==void 0&&{password:o},...n!==void 0&&{session:n}})}logout(){return this.#e("logout")}createTag(e){return this.#e("createTag",{name:e})}addTagsToRoom(e,t){return this.#e("addTagsToRoom",{roomId:e,tags:t})}removeTagsFromRoom(e,t){return this.#e("removeTagsFromRoom",{roomId:e,tags:t})}getEditorInstance(){return this.#e("getEditorInstance")}};var h=class{frames={};init=e=>{let{frameId:t}=e,o=this.frames[t];if(o)return o.initFrame(e),o;let n=new d(e);return n.initFrame(e),this.frames[t]=n,n};initFrame=e=>this.init(e);initManager=e=>this.init({...e,mode:"manager"});initViewer=e=>this.init({...e,mode:"viewer"});initEditor=e=>this.init({...e,mode:"editor"});initRoomSelector=e=>this.init({...e,mode:"room-selector"});initFileSelector=e=>this.init({...e,mode:"file-selector"});initSystem=e=>this.init({...e,mode:"system"})};window.DocSpace=window.DocSpace||{};var E=S();window.DocSpace.SDK=window.DocSpace.SDK||new h;E?.init&&window.DocSpace.SDK.init(E);})();
/**
 * (c) Copyright Ascensio System SIA 2024
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @license
 */
