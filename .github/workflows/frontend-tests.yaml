name: Frontend tests

on:
  push:
    branches: [develop, release/v*, hotfix/v*]
    paths: [packages/**, common/**]
  pull_request:
    branches: [develop, release/v*, hotfix/v*]
    paths: [packages/**, common/**]
jobs:
  playwright:
    name: "Login e2e tests"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: adambirds/docker-compose-action@v1.5.0
        with:
          compose-file: packages/login/compose.yaml
          up-flags: --build --force-recreate
          services: tests-ci
          test-container: tests-ci
          test-command: pnpx playwright test
  eslint:
    name: "Lint tests"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: enable corepack
        run: corepack enable
      - uses: actions/setup-node@v4
        with:
          node-version: "22.x"
          cache: "pnpm"
      - name: Install dependencies
        run: pnpm install
      - name: Lint clients
        run: pnpm lint
  # unit-tests:
  #   name: "Unit tests"
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - name: enable corepack
  #       run: corepack enable
  #     - uses: actions/setup-node@v4
  #       with:
  #         node-version: "22.x"
  #         cache: "pnpm"
  #     - name: Clear pnpm cache
  #       run: pnpm cache clean
  #     - name: Install dependencies
  #       run: pnpm install
  #     - name: Run unit tests
  #       run: pnpm test
  common:
    name: "Common tests"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "22.x"
      - name: Install dependencies
        working-directory: ./common/tests
        run: npm install
      - name: Run common tests
        working-directory: ./common/tests
        run: |
          if [[ "${{ github.event_name }}" == "pull_request" && "${{ github.base_ref }}" == "develop" ]] || [[ "${{ github.event_name }}" == "push" && "${{ github.ref }}" == "develop" ]]; then
            npm run test:skip-base-languages
          else
            npm run test
          fi
